var e,t,n,i,r,s,o,a,l,h,u,d,c,p,f,m,g,w,A,y,v,V,x,E,b,S=Object.defineProperty,R=(e,t,n)=>(((e,t,n)=>{t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const M={pc:'This is my PC. I work mostly in JavaScript/TypeScript these days.\n    I\'ve made a couple of games in that language. I also like Golang and Python. Anyway regardless of the language, I just like programming.\n    Here is my <a href="https://github.com/jslegenddev" target="_blank">Github</a>!',"cs-degree":"This is my CS degree. I hung it on the wall because I'm proud of it. It was a very theoretical degree but I think it gave me a good foundation.","sofa-table":'That\'s my sofa. I like to relax here and watch YouTube. \n  I also make game programming tutorials on YouTube. Go sub to <a href="https://youtube.com/@jslegenddev" target="_blank">my channel</a>! (If you like the content)\n  You\'ll learn how I built this portfolio you\'re currently playing through!',tv:["Currently streaming 10 hours of economic commentary with zero background music.","My mom and dad seem to be nodding seriously."],bed:"This where I sleep. Great ideas comes when I'm lying on my bed. When an idea strikes, I often have to write it down or else I won't be able to sleep because my mental energy is consumed by it.",resume:'This is my desk and on it is my resume. <a href="https://github.com/DataGod9000/Joseph_Resume" target="_blank">Check it out? (hire mi plzzzz &lt;3)</a>',projects:'Info about this portfolio : It\'s made with the Kaboom.js library which is a library for making games in JavaScript.\n  Text is rendered with HTML/CSS. So the textbox you\'re currently reading is not rendered within canvas. Learn more about how to use\n  Kaboom.js by watching some of my tutorials <a href="https://youtube.com/@jslegenddev" target="_blank">here</a>.',library:"There are a lot of programming books on my shelves. There is even one in French (I also speak French btw).\n  I probably only read one of them. Who else compulsively buys technical books without ever finishing them?",exit:"If you want to exit JSLegendDev's portfolio, just close the tab.",into_slime:["Welcome, explorer, to Joseph Land.","A magical territory powered by ambition, mild delusion, and Wi-Fi.","Please explore thoroughly. There may be hidden easter eggs. Or bugs. Hard to tell sometimes."],wenzheng:["Greetings, traveler. I am Wenzheng, Grand Master (Managing Director) of the Data Guild (DBS Data Chapter).","Joseph is our most formidable code-wielder. His SQL slices through inefficiency like enchanted steel.","We once tried to stump him. He replied with a dashboard.","If you're hiring, hurry! He might optimize himself out of this dimension!"],Janet:["I am Janet, keeper (Executive Director) of the Data Guild (DBS Data Chapter).","Joseph is our arcane engineer, bending pipelines to his will.","I sign scrolls while he conquers chaos.","If you require a champion (capable employee), claim (hire) him before another kingdom does."],evan:["Vice President of Data Guide (DBS Data Chapter) and Joseph's direct boss, Evan reporting!","Mission assigned: impossible timeline. Outcome: completed early.","Enemy encountered: legacy system. Result: restructured.","Conclusion: Joseph does not need supervision. He needs larger quests."],chest1:"A wooden chest. It's locked for now.",chest2:"Another chest. What could be inside?",dad:["Joseph's father here.","Joseph. Good boy. Strong. Types very fast.","If you hire him, you are not just gaining talent.","You are stabilizing my retirement portfolio."],mom:["I am Joseph's mom.","I made him. From scratch.","If he writes fast code, it is because I fed him properly.","Please hire him. I have already told all the aunties he is successful."],kiki:["*Woof* (Can't find a dog sprite…) Hi. I am Kiki. I am small but emotionally powerful.","Joseph buys my treats.","If he does not get hired, treat budget will be... reduced.","I will stare at you through the screen."],moca:["*Woof Woof* (No dog sprite…) Hello. I am Moca. I am cute. This is not negotiable.","Joseph funds my snack lifestyle.","If you do not hire him, I may have to downgrade to regular kibble.","Think carefully."],ceyline:["Hi, I'm Ceyline. Joseph's rich Indochinese girlfriend.","If you don't hire him, he will tragically be forced to live off my very large trust fund.","It would be devastating. Think villas. Think yachts. Think mild inconvenience.","Please hire him. I prefer him ambitious, not lounging near inherited assets."],drawers:"Chest of drawers. Clothes and random cables.",tv:["Currently streaming 10 hours of economic commentary with zero background music.","My mom and dad seem to be nodding seriously."],computer:["This is Joseph's computer.","Other developers know some coding languages. Joseph claims to know them all.",'The suspiciously impressive receipts are archived on his GitHub here: <a href="https://github.com/DataGod9000/" target="_blank">https://github.com/DataGod9000/</a>'],fridge:["*opens fridge*","Leftover Indomie. It's not leftover. It's historical.","Matcha. Oat milk. Digestive system has strong opinions.","And an aggressive number of chilli sauce packets. They multiply in the dark.","This is between the fridge and God."],diploma:["This is Joseph's Master's in Computer Science certificate from UPenn.","Somehow a guy who once struggled with printer drivers made it to the Ivy League.","Please clap quietly. He is still confused."],game_console:["Joseph's game console. He plays a lot of Valorant.","Yes, he still instalocks duelist. No, he will not apologise.","Joseph's favourite game is Suikoden II. 108 stars, one heartbreak.","If you haven't played it, he says you can't be friends. (You can. But play it.)"],coffeemachine:"This is a coffee machine... or a printer, depending on who's asking.",shelves:["These are Joseph's bookshelves.","He likes to stand in front of them and pretend he knows how to read."],resume:["This is Ceyline's résumé.","I contain achievements so dense they slightly bend reality.",'Open me now before I add "World Domination (In Progress)" to Experience: <a href="https://github.com/laggylogic/ceyline_resume" target="_blank">Ceyline\'s Resume</a>'],friends:["Hey! We're Ceyline's friends!","She's always talking about her adventures.","Want to check out her house? The door is just over there!"],boyfriend:["Hi, I'm Ceyline's boyfriend.","She didn't fall into IT. I deployed her there.","Currently operating without stable housing. Please hire Ceyline so I can transition from tent to terrace."],guard:["Stop. You cannot enter.","The trust fund is frozen. No withdrawals. No shortcuts.","Please instruct her to secure employment. She has to grind for her own gold."],ceyline_computer:["This is Ceyline's computer.","She spends most of her time here writing code and occasionally whiffing in Valorant.","37 Chrome tabs open, 12 of them are Stack Overflow, 3 are matcha recipes. The rest? Financially questionable decisions.",'Curiosity turned into projects. Projects turned into commits. Commits live here: <a href="https://github.com/laggylogic" target="_blank">github.com/laggylogic</a>',"Early-stage build. Feedback welcomed. Mercy is optional but encouraged."],sister_computer:["This is Ceyline's sister's computer.","It used to be a powerful coding machine.","Now it mostly runs Valorant."],certificate:["A certificate of Diploma in IT hanging on the wall...","It looks very official and important.","Probably cost a lot of effort to earn."],study_table:["A study table covered with books and papers.","Someone has been working hard here.","Or at least pretending to."],ghost:["*spooky noises*",'I don\'t whisper "boo."','I whisper "deadline."',"I appear whenever Ceyline procrastinates.","I'm not here for her soul.","I'm here to ensure Ceyline reaches her full potential. Fear-based motivation."],console:["A gaming console sits here.","It's seen many late-night gaming sessions.","The controller has that well-worn look of dedication."],sister:["Hi, I'm Ceyline's older sister. I used to be a software engineer. Now I'm retiring to open a bakery.","I'm tired of debugging code. I'd rather debug burnt cookies.","So please hire Ceyline… she needs to fund my retirement bakery era."],welcome_bunny:["*hops excitedly*","Welcome to Ceyline's Island!","Feel free to explore! There's a house up ahead and some friendly faces around.","Just watch out for the guard near the castle... he's very serious about his job."],matcha_station:["A matcha station! Ceyline's favorite.","She makes at least 3 matcha lattes a day.","The secret ingredient? Existential dread and oat milk."]};var k=Object.defineProperty,I=(e,t)=>k(e,"name",{value:t,configurable:!0}),T=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var n=t.length,i=new Uint8Array(3*(n-("="==t[n-1])-("="==t[n-2]))/4|0),r=0,s=0;r<n;){var o=e[t.charCodeAt(r++)],a=e[t.charCodeAt(r++)],l=e[t.charCodeAt(r++)],h=e[t.charCodeAt(r++)];i[s++]=o<<2|a>>4,i[s++]=a<<4|l>>2,i[s++]=l<<6|h}return i}})();function P(e){return e*Math.PI/180}function B(e){return 180*e/Math.PI}function C(e,t,n){return t>n?C(e,n,t):Math.min(Math.max(e,t),n)}function F(e,t,n){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*n;if(e instanceof L&&t instanceof L)return e.lerp(t,n);if(e instanceof O&&t instanceof O)return e.lerp(t,n);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function D(e,t,n,i,r){return i+(e-t)/(n-t)*(r-i)}function U(e,t,n,i,r){return C(D(e,t,n,i,r),i,r)}I(P,"deg2rad"),I(B,"rad2deg"),I(C,"clamp"),I(F,"lerp"),I(D,"map"),I(U,"mapc");var L=(I(e=class{constructor(e=0,t=e){R(this,"x",0),R(this,"y",0),this.x=e,this.y=t}static fromAngle(t){let n=P(t);return new e(Math.cos(n),Math.sin(n))}clone(){return new e(this.x,this.y)}add(...t){let n=N(...t);return new e(this.x+n.x,this.y+n.y)}sub(...t){let n=N(...t);return new e(this.x-n.x,this.y-n.y)}scale(...t){let n=N(...t);return new e(this.x*n.x,this.y*n.y)}dist(...e){let t=N(...e);return this.sub(t).len()}sdist(...e){let t=N(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return 0===t?new e(0):this.scale(1/t)}normal(){return new e(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=N(...e);return B(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=N(...e);return B(Math.atan2(this.cross(t),this.dot(t)))}lerp(t,n){return new e(F(this.x,t.x,n),F(this.y,t.y,n))}slerp(e,t){let n=this.dot(e),i=this.cross(e),r=Math.atan2(i,n);return this.scale(Math.sin((1-t)*r)).add(e.scale(Math.sin(t*r))).scale(1/i)}isZero(){return 0===this.x&&0===this.y}toFixed(t){return new e(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new de(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},"Vec2"),R(e,"LEFT",new e(-1,0)),R(e,"RIGHT",new e(1,0)),R(e,"UP",new e(0,-1)),R(e,"DOWN",new e(0,1)),e);function N(...e){if(1===e.length){if(e[0]instanceof L)return new L(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new L(...e[0])}return new L(...e)}I(N,"vec2");var O=(t=class{constructor(e,t,n){R(this,"r",255),R(this,"g",255),R(this,"b",255),this.r=C(e,0,255),this.g=C(t,0,255),this.b=C(n,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if("number"==typeof e)return new t(e>>16&255,e>>8&255,e>>0&255);if("string"==typeof e){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new t(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}throw new Error("Invalid hex color format")}static fromHSL(e,n,i){if(0==n)return new t(255*i,255*i,255*i);let r=I(((e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e)),"hue2rgb"),s=i<.5?i*(1+n):i+n-i*n,o=2*i-s,a=r(o,s,e+1/3),l=r(o,s,e),h=r(o,s,e-1/3);return new t(Math.round(255*a),Math.round(255*l),Math.round(255*h))}clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new t(F(this.r,e.r,n),F(this.g,e.g,n),F(this.b,e.b,n))}toHSL(){let e=this.r/255,t=this.g/255,n=this.b/255,i=Math.max(e,t,n),r=Math.min(e,t,n),s=(i+r)/2,o=s,a=s;if(i==r)s=o=0;else{let l=i-r;switch(o=a>.5?l/(2-i-r):l/(i+r),i){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return[s,o,a]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},I(t,"Color"),R(t,"RED",new t(255,0,0)),R(t,"GREEN",new t(0,255,0)),R(t,"BLUE",new t(0,0,255)),R(t,"YELLOW",new t(255,255,0)),R(t,"MAGENTA",new t(255,0,255)),R(t,"CYAN",new t(0,255,255)),R(t,"WHITE",new t(255,255,255)),R(t,"BLACK",new t(0,0,0)),t);function G(...e){if(0===e.length)return new O(255,255,255);if(1===e.length){if(e[0]instanceof O)return e[0].clone();if("string"==typeof e[0])return O.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return O.fromArray(e[0])}return new O(...e)}I(G,"rgb");var q=I(((e,t,n)=>O.fromHSL(e,t,n)),"hsl2rgb"),H=(I(n=class{constructor(e,t,n,i){R(this,"x",0),R(this,"y",0),R(this,"w",1),R(this,"h",1),this.x=e,this.y=t,this.w=n,this.h=i}scale(e){return new n(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new L(this.x,this.y)}clone(){return new n(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},"Quad"),n);function j(e,t,n,i){return new H(e,t,n,i)}I(j,"quad");var K=(I(i=class{constructor(e){R(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e&&(this.m=e)}static translate(e){return new i([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new i([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=P(-e);let t=Math.cos(e),n=Math.sin(e);return new i([1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1])}static rotateY(e){e=P(-e);let t=Math.cos(e),n=Math.sin(e);return new i([t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1])}static rotateZ(e){e=P(-e);let t=Math.cos(e),n=Math.sin(e);return new i([t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=P(-e);let t=Math.cos(e),n=Math.sin(e),i=this.m[0],r=this.m[1],s=this.m[4],o=this.m[5];return this.m[0]=i*t+r*n,this.m[1]=-i*n+r*t,this.m[4]=s*t+o*n,this.m[5]=-s*n+o*t,this}mult(e){let t=[];for(let n=0;n<4;n++)for(let i=0;i<4;i++)t[4*n+i]=this.m[0+i]*e.m[4*n+0]+this.m[4+i]*e.m[4*n+1]+this.m[8+i]*e.m[4*n+2]+this.m[12+i]*e.m[4*n+3];return new i(t)}multVec2(e){return new L(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new L(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new L(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new L(e/t,t)}return new L(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return B(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return B(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new L(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new L(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new L(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],s=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],p=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],m=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],A=this.m[4]*this.m[11]-this.m[8]*this.m[7],y=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*n+this.m[7]*r,e[4]=-(this.m[4]*t-this.m[6]*s+this.m[7]*o),e[8]=this.m[4]*n-this.m[5]*s+this.m[7]*a,e[12]=-(this.m[4]*r-this.m[5]*o+this.m[6]*a),e[1]=-(this.m[1]*t-this.m[2]*n+this.m[3]*r),e[5]=this.m[0]*t-this.m[2]*s+this.m[3]*o,e[9]=-(this.m[0]*n-this.m[1]*s+this.m[3]*a),e[13]=this.m[0]*r-this.m[1]*o+this.m[2]*a,e[2]=this.m[1]*l-this.m[2]*h+this.m[3]*u,e[6]=-(this.m[0]*l-this.m[2]*d+this.m[3]*c),e[10]=this.m[0]*p-this.m[1]*d+this.m[3]*f,e[14]=-(this.m[0]*u-this.m[1]*c+this.m[2]*f),e[3]=-(this.m[1]*m-this.m[2]*g+this.m[3]*w),e[7]=this.m[0]*m-this.m[2]*A+this.m[3]*y,e[11]=-(this.m[0]*g-this.m[1]*A+this.m[3]*v),e[15]=this.m[0]*w-this.m[1]*y+this.m[2]*v;let V=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let i=0;i<4;i++)for(let t=0;t<4;t++)e[4*i+t]*=1/V;return new i(e)}clone(){return new i([...this.m])}toString(){return this.m.toString()}},"Mat4"),i);function Y(e,t,n,i=(e=>-Math.cos(e))){return e+(i(n)+1)/2*(t-e)}I(Y,"wave");var z=2147483648,J=(I(r=class{constructor(e){R(this,"seed"),this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%z,this.seed/z}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new L(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new O(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof L)return this.genVec2(N(0,0),e[0]);if(e[0]instanceof O)return this.genColor(G(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof L&&e[1]instanceof L)return this.genVec2(e[0],e[1]);if(e[0]instanceof O&&e[1]instanceof O)return this.genColor(e[0],e[1])}}},"RNG"),r),Q=new J(Date.now());function W(e){return null!=e&&(Q.seed=e),Q.seed}function X(...e){return Q.genAny(...e)}function Z(...e){return Math.floor(X(...e))}function _(e){return X()<=e}function $(e){return e[Z(e.length)]}function ee(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function te(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let n=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===n)return null;let i=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/n,r=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/n;return i<0||i>1||r<0||r>1?null:i}function ne(e,t){let n=te(e,t);return n?N(e.p1.x+n*(e.p2.x-e.p1.x),e.p1.y+n*(e.p2.y-e.p1.y)):null}function ie(e,t){if(re(e,t.p1)||re(e,t.p2))return!0;let n=e.points();return!!(ne(t,new ue(n[0],n[1]))||ne(t,new ue(n[1],n[2]))||ne(t,new ue(n[2],n[3]))||ne(t,new ue(n[3],n[0])))}function re(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function se(e,t){let n=t.sub(e.p1),i=e.p2.sub(e.p1);if(Math.abs(n.cross(i))>Number.EPSILON)return!1;let r=n.dot(i)/i.dot(i);return r>=0&&r<=1}function oe(e,t){let n=e.p2.sub(e.p1),i=n.dot(n),r=e.p1.sub(t.center),s=2*n.dot(r),o=s*s-4*i*(r.dot(r)-t.radius*t.radius);if(i<=Number.EPSILON||o<0)return!1;if(0==o){let e=-s/(2*i);if(e>=0&&e<=1)return!0}else{let e=(-s+Math.sqrt(o))/(2*i),t=(-s-Math.sqrt(o))/(2*i);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return ae(t,e.p1)}function ae(e,t){return e.center.sdist(t)<e.radius*e.radius}function le(e,t){let n=t.pts[t.pts.length-1];for(let i of t.pts){if(oe(new ue(n,i),e))return!0;n=i}return!!ae(e,t.pts[0])||he(t,e.center)}function he(e,t){let n=!1,i=e.pts;for(let r=0,s=i.length-1;r<i.length;s=r++)i[r].y>t.y!=i[s].y>t.y&&t.x<(i[s].x-i[r].x)*(t.y-i[r].y)/(i[s].y-i[r].y)+i[r].x&&(n=!n);return n}I(W,"randSeed"),I(X,"rand"),I(Z,"randi"),I(_,"chance"),I($,"choose"),I(ee,"testRectRect"),I(te,"testLineLineT"),I(ne,"testLineLine"),I(ie,"testRectLine"),I(re,"testRectPoint"),I(se,"testLinePoint"),I(oe,"testLineCircle"),I(ae,"testCirclePoint"),I(le,"testCirclePolygon"),I(he,"testPolygonPoint");var ue=(I(s=class{constructor(e,t){R(this,"p1"),R(this,"p2"),this.p1=e.clone(),this.p2=t.clone()}transform(e){return new s(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return de.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new s(this.p1,this.p2)}},"Line"),s),de=(I(o=class{constructor(e,t,n){R(this,"pos"),R(this,"width"),R(this,"height"),this.pos=e.clone(),this.width=t,this.height=n}static fromPoints(e,t){return new o(e.clone(),t.x-e.x,t.y-e.y)}center(){return new L(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new fe(this.points().map((t=>e.multVec2(t))))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new o(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,n=this.pos.add(this.width,this.height),i=Math.max(t.x-e.x,0,e.x-n.x),r=Math.max(t.y-e.y,0,e.y-n.y);return i*i+r*r}},"Rect"),o),ce=(I(a=class{constructor(e,t){R(this,"center"),R(this,"radius"),this.center=e.clone(),this.radius=t}transform(e){return new pe(this.center,this.radius,this.radius).transform(e)}bbox(){return de.fromPoints(this.center.sub(N(this.radius)),this.center.add(N(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new a(this.center,this.radius)}},"Circle"),a),pe=(I(l=class{constructor(e,t,n){R(this,"center"),R(this,"radiusX"),R(this,"radiusY"),this.center=e.clone(),this.radiusX=t,this.radiusY=n}transform(e){return new l(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return de.fromPoints(this.center.sub(N(this.radiusX,this.radiusY)),this.center.add(N(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new l(this.center,this.radiusX,this.radiusY)}},"Ellipse"),l),fe=(I(h=class{constructor(e){if(R(this,"pts"),e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new h(this.pts.map((t=>e.multVec2(t))))}bbox(){let e=N(Number.MAX_VALUE),t=N(-Number.MAX_VALUE);for(let n of this.pts)e.x=Math.min(e.x,n.x),t.x=Math.max(t.x,n.x),e.y=Math.min(e.y,n.y),t.y=Math.max(t.y,n.y);return de.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let n=0;n<t;n++){let i=this.pts[n],r=this.pts[(n+1)%t];e+=i.x*r.y*.5,e-=r.x*i.y*.5}return Math.abs(e)}clone(){return new h(this.pts.map((e=>e.clone())))}},"Polygon"),h);function me(e,t){let n=Number.MAX_VALUE,i=N(0);for(let r of[e,t])for(let s=0;s<r.pts.length;s++){let o=r.pts[s],a=r.pts[(s+1)%r.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let n=e.pts[t].dot(a);l=Math.min(l,n),h=Math.max(h,n)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let n=t.pts[e].dot(a);u=Math.min(u,n),d=Math.max(d,n)}let c=Math.min(h,d)-Math.max(l,u);if(c<0)return null;if(c<Math.abs(n)){let e=d-l,t=u-h;n=Math.abs(e)<Math.abs(t)?e:t,i=a.scale(n)}}return i}I(me,"sat");var ge=(u=class extends Map{constructor(...e){super(...e),R(this,"lastID"),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},I(u,"Registry"),u),we=(I(d=class{constructor(e){R(this,"paused",!1),R(this,"cancel"),this.cancel=e}static join(e){let t=new d((()=>e.forEach((e=>e.cancel()))));return Object.defineProperty(t,"paused",{get:()=>e[0].paused,set:t=>e.forEach((e=>e.paused=t))}),t.paused=!1,t}},"EventController"),d),Ae=(I(c=class{constructor(){R(this,"handlers",new ge)}add(e){let t=this.handlers.pushd(((...t)=>{n.paused||e(...t)})),n=new we(t);return n}addOnce(e){let t=this.add(((...n)=>{t.cancel(),e(...n)}));return t}next(){return new Promise((e=>this.addOnce(e)))}trigger(...e){this.handlers.forEach((t=>t(...e)))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},"Event"),c),ye=(I(p=class{constructor(){R(this,"handlers",{})}on(e,t){return this.handlers[e]||(this.handlers[e]=new Ae),this.handlers[e].add(t)}onOnce(e,t){let n=this.on(e,((...e)=>{n.cancel(),t(...e)}));return n}next(e){return new Promise((t=>{this.onOnce(e,((...e)=>t(e[0])))}))}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var t;return(null==(t=this.handlers[e])?void 0:t.numListeners())??0}},"EventHandler"),p);function ve(e,t){if(e===t)return!0;let n=typeof e,i=typeof t;if(n!==i)return!1;if("object"===n&&"object"===i&&null!==e&&null!==t){if(Array.isArray(e)!==Array.isArray(t))return!1;let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let r of n){if(!ve(e[r],t[r]))return!1}return!0}return!1}function Ve(e){let t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=t.charCodeAt(r);return i.buffer}function xe(e){return Ve(e.split(",")[1])}function Ee(e,t){let n=document.createElement("a");n.href=t,n.download=e,n.click()}function be(e,t){Ee(e,"data:text/plain;charset=utf-8,"+t)}function Se(e,t){be(e,JSON.stringify(t))}function Re(e,t){let n=URL.createObjectURL(t);Ee(e,n),URL.revokeObjectURL(n)}I(ve,"deepEq"),I(Ve,"base64ToArrayBuffer"),I(xe,"dataURLToArrayBuffer"),I(Ee,"download"),I(be,"downloadText"),I(Se,"downloadJSON"),I(Re,"downloadBlob");var Me=I((e=>e.match(/^data:\w+\/\w+;base64,.+/)),"isDataURL"),ke=I((e=>e.split(".").slice(0,-1).join(".")),"getFileName");function Ie(e,t){return(...n)=>{let i=n.length;return i===e.length?e(...n):i===t.length?t(...n):void 0}}I(Ie,"overload2");var Te=(()=>{let e=0;return()=>e++})(),Pe=I((e=>e instanceof Error?e.message:String(e)),"getErrorMessage"),Be=(I(f=class{constructor(e=((e,t)=>e<t)){R(this,"_items"),R(this,"_compareFn"),this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},"BinaryHeap"),f),Ce=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Fe(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");let t=[],n=0,i=0;for(;n<e.length;)i+=De(n+i,e),je(e[n+i])&&i++,Ge(e[n+i])&&i++,qe(e[n+i])&&i++,Ke(e[n+i])?i++:(t.push(e.substring(n,n+i)),n+=i,i=0);return t}function De(e,t){let n=t[e];if(!Ue(n)||e===t.length-1)return 1;let i=n+t[e+1],r=t.substring(e+2,e+5);return Le(i)&&Le(r)?4:Ne(i)&&He(r)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:Oe(r)?4:2}function Ue(e){return e&&ze(e[0].charCodeAt(0),55296,56319)}function Le(e){return ze(Ye(e),127462,127487)}function Ne(e){return ze(Ye(e),127988,127988)}function Oe(e){return ze(Ye(e),127995,127999)}function Ge(e){return"string"==typeof e&&ze(e.charCodeAt(0),65024,65039)}function qe(e){return"string"==typeof e&&ze(e.charCodeAt(0),8400,8447)}function He(e){let t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&ze(t,917504,917631)}function je(e){return"string"==typeof e&&Ce.includes(e.charCodeAt(0))}function Ke(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function Ye(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function ze(e,t,n){return e>=t&&e<=n}I(Fe,"runes"),I(De,"nextUnits"),I(Ue,"isFirstOfSurrogatePair"),I(Le,"isRegionalIndicator"),I(Ne,"isSubdivisionFlag"),I(Oe,"isFitzpatrickModifier"),I(Ge,"isVariationSelector"),I(qe,"isDiacriticalMark"),I(He,"isSupplementarySpecialpurposePlane"),I(je,"isGrapheme"),I(Ke,"isZeroWidthJoiner"),I(Ye,"codePointFromSurrogatePair"),I(ze,"betweenInclusive");var Je={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Qe=(I(m=class{constructor(){R(this,"pressed",new Set([])),R(this,"pressedRepeat",new Set([])),R(this,"released",new Set([])),R(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},"ButtonState"),m),We=(I(g=class{constructor(){R(this,"buttonState",new Qe),R(this,"stickState",new Map)}},"GamepadState"),g),Xe=(I(w=class{constructor(){R(this,"dts",[]),R(this,"timer",0),R(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((e,t)=>e+t))/this.dts.length)),this.dts=[])}},"FPSCounter"),w),Ze=I((e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new Xe,timeScale:1,skipTime:!1,numFrames:0,mousePos:new L(0),mouseDeltaPos:new L(0),keyState:new Qe,mouseState:new Qe,mergedGamepadState:new We,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new ye};function n(){return t.dt*t.timeScale}function i(){return t.time}function r(){return t.fpsCounter.fps}function s(){return t.numFrames}function o(){return t.canvas.toDataURL()}function a(e){t.canvas.style.cursor=e}function l(){return t.canvas.style.cursor}function h(e){if(e)try{let e=t.canvas.requestPointerLock();e.catch&&e.catch((e=>console.error(e)))}catch(n){console.error(n)}else document.exitPointerLock()}function u(){return!!document.pointerLockElement}function d(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function c(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function p(){return document.fullscreenElement||document.webkitFullscreenElement}function f(e=!0){e?d(t.canvas):c()}function m(){return!!p()}function g(){t.stopped=!0;for(let e in de)t.canvas.removeEventListener(e,de[e]);for(let e in ce)document.removeEventListener(e,ce[e]);for(let e in pe)window.removeEventListener(e,pe[e]);Ae.disconnect()}function w(i){null!==t.loopID&&cancelAnimationFrame(t.loopID);let r=0,s=I((o=>{if(t.stopped)return;if("visible"!==document.visibilityState)return void(t.loopID=requestAnimationFrame(s));let a=o/1e3,l=a-t.realTime,h=e.maxFPS?1/e.maxFPS:0;t.realTime=a,r+=l,r>h&&(t.skipTime||(t.dt=r,t.time+=n(),t.fpsCounter.tick(t.dt)),r=0,t.skipTime=!1,t.numFrames++,oe(),i(),ae()),t.loopID=requestAnimationFrame(s)}),"frame");s(0)}function A(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function y(){return t.mousePos.clone()}function v(){return t.mouseDeltaPos.clone()}function V(e="left"){return t.mouseState.pressed.has(e)}function x(e="left"){return t.mouseState.down.has(e)}function E(e="left"){return t.mouseState.released.has(e)}function b(){return t.isMouseMoved}function S(e){return void 0===e?t.keyState.pressed.size>0:t.keyState.pressed.has(e)}function R(e){return void 0===e?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(e)}function M(e){return void 0===e?t.keyState.down.size>0:t.keyState.down.has(e)}function k(e){return void 0===e?t.keyState.released.size>0:t.keyState.released.has(e)}function T(e){return void 0===e?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(e)}function P(e){return void 0===e?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(e)}function B(e){return void 0===e?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(e)}function C(e){return t.events.on("resize",e)}I(n,"dt"),I(i,"time"),I(r,"fps"),I(s,"numFrames"),I(o,"screenshot"),I(a,"setCursor"),I(l,"getCursor"),I(h,"setCursorLocked"),I(u,"isCursorLocked"),I(d,"enterFullscreen"),I(c,"exitFullscreen"),I(p,"getFullscreenElement"),I(f,"setFullscreen"),I(m,"isFullscreen"),I(g,"quit"),I(w,"run"),I(A,"isTouchscreen"),I(y,"mousePos"),I(v,"mouseDeltaPos"),I(V,"isMousePressed"),I(x,"isMouseDown"),I(E,"isMouseReleased"),I(b,"isMouseMoved"),I(S,"isKeyPressed"),I(R,"isKeyPressedRepeat"),I(M,"isKeyDown"),I(k,"isKeyReleased"),I(T,"isGamepadButtonPressed"),I(P,"isGamepadButtonDown"),I(B,"isGamepadButtonReleased"),I(C,"onResize");let F=Ie((e=>t.events.on("keyDown",e)),((e,n)=>t.events.on("keyDown",(t=>t===e&&n(e))))),U=Ie((e=>t.events.on("keyPress",e)),((e,n)=>t.events.on("keyPress",(t=>t===e&&n(e))))),N=Ie((e=>t.events.on("keyPressRepeat",e)),((e,n)=>t.events.on("keyPressRepeat",(t=>t===e&&n(e))))),O=Ie((e=>t.events.on("keyRelease",e)),((e,n)=>t.events.on("keyRelease",(t=>t===e&&n(e))))),G=Ie((e=>t.events.on("mouseDown",(t=>e(t)))),((e,n)=>t.events.on("mouseDown",(t=>t===e&&n(t))))),q=Ie((e=>t.events.on("mousePress",(t=>e(t)))),((e,n)=>t.events.on("mousePress",(t=>t===e&&n(t))))),H=Ie((e=>t.events.on("mouseRelease",(t=>e(t)))),((e,n)=>t.events.on("mouseRelease",(t=>t===e&&n(t)))));function j(e){return t.events.on("mouseMove",(()=>e(y(),v())))}function K(e){return t.events.on("charInput",e)}function Y(e){return t.events.on("touchStart",e)}function z(e){return t.events.on("touchMove",e)}function J(e){return t.events.on("touchEnd",e)}function Q(e){return t.events.on("scroll",e)}function W(e){return t.events.on("hide",e)}function X(e){return t.events.on("show",e)}function Z(e,n){return"function"==typeof e?t.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof n?t.events.on("gamepadButtonDown",(t=>t===e&&n(e))):void 0}function _(e,n){return"function"==typeof e?t.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof n?t.events.on("gamepadButtonPress",(t=>t===e&&n(e))):void 0}function $(e,n){return"function"==typeof e?t.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof n?t.events.on("gamepadButtonRelease",(t=>t===e&&n(e))):void 0}function ee(e,n){return t.events.on("gamepadStick",((t,i)=>t===e&&n(i)))}function te(e){t.events.on("gamepadConnect",e)}function ne(e){t.events.on("gamepadDisconnect",e)}function ie(e){return t.mergedGamepadState.stickState.get(e)||new L(0)}function re(){return[...t.charInputted]}function se(){return[...t.gamepads]}function oe(){t.events.trigger("input"),t.keyState.down.forEach((e=>t.events.trigger("keyDown",e))),t.mouseState.down.forEach((e=>t.events.trigger("mouseDown",e))),ue()}function ae(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach(((e,n)=>{t.mergedGamepadState.stickState.set(n,new L(0))})),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach((e=>{e.buttonState.update(),e.stickState.forEach(((t,n)=>{e.stickState.set(n,new L(0))}))}))}function le(e){let n={index:e.index,isPressed:n=>t.gamepadStates.get(e.index).buttonState.pressed.has(n),isDown:n=>t.gamepadStates.get(e.index).buttonState.down.has(n),isReleased:n=>t.gamepadStates.get(e.index).buttonState.released.has(n),getStick:n=>t.gamepadStates.get(e.index).stickState.get(n)};return t.gamepads.push(n),t.gamepadStates.set(e.index,{buttonState:new Qe,stickState:new Map([["left",new L(0)],["right",new L(0)]])}),n}function he(e){t.gamepads=t.gamepads.filter((t=>t.index!==e.index)),t.gamepadStates.delete(e.index)}function ue(){for(let e of navigator.getGamepads())e&&!t.gamepadStates.has(e.index)&&le(e);for(let n of t.gamepads){let i=navigator.getGamepads()[n.index],r=(e.gamepads??{})[i.id]??Je[i.id]??Je.default,s=t.gamepadStates.get(n.index);for(let e=0;e<i.buttons.length;e++)i.buttons[e].pressed?(s.buttonState.down.has(r.buttons[e])||(t.mergedGamepadState.buttonState.press(r.buttons[e]),s.buttonState.press(r.buttons[e]),t.events.trigger("gamepadButtonPress",r.buttons[e])),t.events.trigger("gamepadButtonDown",r.buttons[e])):s.buttonState.down.has(r.buttons[e])&&(t.mergedGamepadState.buttonState.release(r.buttons[e]),s.buttonState.release(r.buttons[e]),t.events.trigger("gamepadButtonRelease",r.buttons[e]));for(let e in r.sticks){let n=r.sticks[e],o=new L(i.axes[n.x],i.axes[n.y]);s.stickState.set(e,o),t.mergedGamepadState.stickState.set(e,o),t.events.trigger("gamepadStick",e,o)}}}I(j,"onMouseMove"),I(K,"onCharInput"),I(Y,"onTouchStart"),I(z,"onTouchMove"),I(J,"onTouchEnd"),I(Q,"onScroll"),I(W,"onHide"),I(X,"onShow"),I(Z,"onGamepadButtonDown"),I(_,"onGamepadButtonPress"),I($,"onGamepadButtonRelease"),I(ee,"onGamepadStick"),I(te,"onGamepadConnect"),I(ne,"onGamepadDisconnect"),I(ie,"getGamepadStick"),I(re,"charInputted"),I(se,"getGamepads"),I(oe,"processInput"),I(ae,"resetInput"),I(le,"registerGamepad"),I(he,"removeGamepad"),I(ue,"processGamepad");let de={},ce={},pe={},fe=e.pixelDensity||window.devicePixelRatio||1;de.mousemove=e=>{let n=new L(e.offsetX,e.offsetY),i=new L(e.movementX,e.movementY);if(m()){let i=t.canvas.width/fe,r=t.canvas.height/fe,s=window.innerWidth,o=window.innerHeight;if(s/o>i/r){let t=o/r,a=(s-i*t)/2;n.x=D(e.offsetX-a,0,i*t,0,i),n.y=D(e.offsetY,0,r*t,0,r)}else{let t=s/i,a=(o-r*t)/2;n.x=D(e.offsetX,0,i*t,0,i),n.y=D(e.offsetY-a,0,r*t,0,r)}}t.events.onOnce("input",(()=>{t.isMouseMoved=!0,t.mousePos=n,t.mouseDeltaPos=i,t.events.trigger("mouseMove")}))};let me=["left","middle","right","back","forward"];de.mousedown=e=>{t.events.onOnce("input",(()=>{let n=me[e.button];n&&(t.mouseState.press(n),t.events.trigger("mousePress",n))}))},de.mouseup=e=>{t.events.onOnce("input",(()=>{let n=me[e.button];n&&(t.mouseState.release(n),t.events.trigger("mouseRelease",n))}))};let ge=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),we={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};de.keydown=e=>{ge.has(e.key)&&e.preventDefault(),t.events.onOnce("input",(()=>{let n=we[e.key]||e.key.toLowerCase();1===n.length?(t.events.trigger("charInput",n),t.charInputted.push(n)):"space"===n&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),e.repeat?(t.keyState.pressRepeat(n),t.events.trigger("keyPressRepeat",n)):(t.keyState.press(n),t.events.trigger("keyPressRepeat",n),t.events.trigger("keyPress",n))}))},de.keyup=e=>{t.events.onOnce("input",(()=>{let n=we[e.key]||e.key.toLowerCase();t.keyState.release(n),t.events.trigger("keyRelease",n)}))},de.touchstart=n=>{n.preventDefault(),t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(i[0].clientX-r.x,i[0].clientY-r.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),i.forEach((e=>{t.events.trigger("touchStart",new L(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.touchmove=n=>{n.preventDefault(),t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(i[0].clientX-r.x,i[0].clientY-r.y),t.events.trigger("mouseMove")),i.forEach((e=>{t.events.trigger("touchMove",new L(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.touchend=n=>{t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(i[0].clientX-r.x,i[0].clientY-r.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),i.forEach((e=>{t.events.trigger("touchEnd",new L(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.touchcancel=n=>{t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(i[0].clientX-r.x,i[0].clientY-r.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),i.forEach((e=>{t.events.trigger("touchEnd",new L(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.wheel=e=>{e.preventDefault(),t.events.onOnce("input",(()=>{t.events.trigger("scroll",new L(e.deltaX,e.deltaY))}))},de.contextmenu=e=>e.preventDefault(),ce.visibilitychange=()=>{"visible"===document.visibilityState?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},pe.gamepadconnected=e=>{let n=le(e.gamepad);t.events.onOnce("input",(()=>{t.events.trigger("gamepadConnect",n)}))},pe.gamepaddisconnected=e=>{let n=se().filter((t=>t.index===e.gamepad.index))[0];he(e.gamepad),t.events.onOnce("input",(()=>{t.events.trigger("gamepadDisconnect",n)}))};for(let I in de)t.canvas.addEventListener(I,de[I]);for(let I in ce)document.addEventListener(I,ce[I]);for(let I in pe)window.addEventListener(I,pe[I]);let Ae=new ResizeObserver((e=>{for(let n of e)if(n.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",(()=>{t.events.trigger("resize")}))}}));return Ae.observe(t.canvas),{dt:n,time:i,run:w,canvas:t.canvas,fps:r,numFrames:s,quit:g,setFullscreen:f,isFullscreen:m,setCursor:a,screenshot:o,getGamepads:se,getCursor:l,setCursorLocked:h,isCursorLocked:u,isTouchscreen:A,mousePos:y,mouseDeltaPos:v,isKeyDown:M,isKeyPressed:S,isKeyPressedRepeat:R,isKeyReleased:k,isMouseDown:x,isMousePressed:V,isMouseReleased:E,isMouseMoved:b,isGamepadButtonPressed:T,isGamepadButtonDown:P,isGamepadButtonReleased:B,getGamepadStick:ie,charInputted:re,onResize:C,onKeyDown:F,onKeyPress:U,onKeyPressRepeat:N,onKeyRelease:O,onMouseDown:G,onMousePress:q,onMouseRelease:H,onMouseMove:j,onCharInput:K,onTouchStart:Y,onTouchMove:z,onTouchEnd:J,onScroll:Q,onHide:W,onShow:X,onGamepadButtonDown:Z,onGamepadButtonPress:_,onGamepadButtonRelease:$,onGamepadStick:ee,onGamepadConnect:te,onGamepadDisconnect:ne,events:t.events}}),"default"),_e=(I(A=class{constructor(e,t,n,i={}){R(this,"ctx"),R(this,"src",null),R(this,"glTex"),R(this,"width"),R(this,"height"),this.ctx=e;let r=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy((()=>this.free())),this.width=t,this.height=n;let s={linear:r.LINEAR,nearest:r.NEAREST}[i.filter??e.opts.texFilter]??r.NEAREST,o={repeat:r.REPEAT,clampToEadge:r.CLAMP_TO_EDGE}[i.wrap]??r.CLAMP_TO_EDGE;this.bind(),t&&n&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,n,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,o),this.unbind()}static fromImage(e,t,n={}){let i=new A(e,t.width,t.height,n);return i.update(t),i.src=t,i}update(e,t=0,n=0){let i=this.ctx.gl;this.bind(),i.texSubImage2D(i.TEXTURE_2D,0,t,n,i.RGBA,i.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},"Texture"),A),$e=(I(y=class{constructor(e,t,n,i={}){R(this,"ctx"),R(this,"tex"),R(this,"glFramebuffer"),R(this,"glRenderbuffer"),this.ctx=e;let r=e.gl;e.onDestroy((()=>this.free())),this.tex=new _e(e,t,n,i),this.glFramebuffer=r.createFramebuffer(),this.glRenderbuffer=r.createRenderbuffer(),this.bind(),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.tex.glTex,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let n=4*this.width,i=new Uint8Array(n);for(let r=0;r<(this.height/2|0);r++){let e=r*n,s=(this.height-r-1)*n;i.set(t.subarray(e,e+n)),t.copyWithin(e,s,s+n),t.set(i,s)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.width,e.height=this.height,t.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},"FrameBuffer"),y),et=(I(v=class{constructor(e,t,n,i){R(this,"ctx"),R(this,"glProgram"),this.ctx=e,e.onDestroy((()=>this.free()));let r=e.gl,s=r.createShader(r.VERTEX_SHADER),o=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(s,t),r.shaderSource(o,n),r.compileShader(s),r.compileShader(o);let a=r.createProgram();if(this.glProgram=a,r.attachShader(a,s),r.attachShader(a,o),i.forEach(((e,t)=>r.bindAttribLocation(a,t,e))),r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS)){let e=r.getShaderInfoLog(s);if(e)throw new Error("VERTEX SHADER "+e);let t=r.getShaderInfoLog(o);if(t)throw new Error("FRAGMENT SHADER "+t)}r.deleteShader(s),r.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let n in e){let i=e[n],r=t.getUniformLocation(this.glProgram,n);"number"==typeof i?t.uniform1f(r,i):i instanceof K?t.uniformMatrix4fv(r,!1,new Float32Array(i.m)):i instanceof O?t.uniform3f(r,i.r,i.g,i.b):i instanceof L&&t.uniform2f(r,i.x,i.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},"Shader"),v),tt=(I(V=class{constructor(e,t,n,i){R(this,"ctx"),R(this,"glVBuf"),R(this,"glIBuf"),R(this,"vqueue",[]),R(this,"iqueue",[]),R(this,"stride"),R(this,"maxVertices"),R(this,"maxIndices"),R(this,"vertexFormat"),R(this,"numDraws",0),R(this,"curPrimitive",null),R(this,"curTex",null),R(this,"curShader",null),R(this,"curUniform",{});let r=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce(((e,t)=>e+t.size),0),this.maxVertices=n,this.maxIndices=i,this.glVBuf=r.createBuffer(),e.pushArrayBuffer(this.glVBuf),r.bufferData(r.ARRAY_BUFFER,4*n,r.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=r.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),r.bufferData(r.ELEMENT_ARRAY_BUFFER,4*i,r.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,n,i,r=null,s={}){(e!==this.curPrimitive||r!==this.curTex||i!==this.curShader||!ve(this.curUniform,s)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+n.length>this.maxIndices)&&this.flush();let o=this.vqueue.length/this.stride;for(let a of t)this.vqueue.push(a);for(let a of n)this.iqueue.push(a+o);this.curPrimitive=e,this.curShader=i,this.curTex=r,this.curUniform=s}flush(){var e,t;if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let n=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),n.bufferSubData(n.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),null==(e=this.curTex)||e.bind(),n.drawElements(this.curPrimitive,this.iqueue.length,n.UNSIGNED_SHORT,0),null==(t=this.curTex)||t.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},"BatchRenderer"),V);function nt(e){let t=[],n=I((n=>{t.push(n),e(n)}),"push"),i=I((()=>{t.pop(),e(r()??null)}),"pop"),r=I((()=>t[t.length-1]),"cur");return[n,i,r]}function it(e,t={}){let n=[];function i(e){n.push(e)}function r(){n.forEach((e=>e())),e.getExtension("WEBGL_lose_context").loseContext()}I(i,"onDestroy"),I(r,"destroy");let s=null;function o(t){if(ve(t,s))return;s=t;let n=t.reduce(((e,t)=>e+t.size),0);t.reduce(((t,i,r)=>(e.vertexAttribPointer(r,i.size,e.FLOAT,!1,4*n,t),e.enableVertexAttribArray(r),t+4*i.size)),0)}I(o,"setVertexFormat");let[a,l]=nt((t=>e.bindTexture(e.TEXTURE_2D,t))),[h,u]=nt((t=>e.bindBuffer(e.ARRAY_BUFFER,t))),[d,c]=nt((t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t))),[p,f]=nt((t=>e.bindFramebuffer(e.FRAMEBUFFER,t))),[m,g]=nt((t=>e.bindRenderbuffer(e.RENDERBUFFER,t))),[w,A]=nt((({x:t,y:n,w:i,h:r})=>{e.viewport(t,n,i,r)})),[y,v]=nt((t=>e.useProgram(t)));return w({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:i,destroy:r,pushTexture2D:a,popTexture2D:l,pushArrayBuffer:h,popArrayBuffer:u,pushElementArrayBuffer:d,popElementArrayBuffer:c,pushFramebuffer:p,popFramebuffer:f,pushRenderbuffer:m,popRenderbuffer:g,pushViewport:w,popViewport:A,pushProgram:y,popProgram:v,setVertexFormat:o}}I(nt,"genStack"),I(it,"initGfx");var rt=(I(x=class{constructor(e){R(this,"loaded",!1),R(this,"data",null),R(this,"error",null),R(this,"onLoadEvents",new Ae),R(this,"onErrorEvents",new Ae),R(this,"onFinishEvents",new Ae),e.then((e=>{this.data=e,this.onLoadEvents.trigger(e)})).catch((e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)})).finally((()=>{this.onFinishEvents.trigger(),this.loaded=!0}))}static loaded(e){let t=new x(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},"Asset"),x),st=(I(E=class{constructor(){R(this,"assets",new Map),R(this,"lastUID",0)}add(e,t){let n=e??this.lastUID+++"",i=new rt(t);return this.assets.set(n,i),i}addLoaded(e,t){let n=e??this.lastUID+++"",i=rt.loaded(t);return this.assets.set(n,i),i}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach((t=>{t.loaded&&e++})),e/this.assets.size}},"AssetBucket"),E);function ot(e){return fetch(e).then((t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t}))}function at(e){return ot(e).then((e=>e.json()))}function lt(e){return ot(e).then((e=>e.text()))}function ht(e){return ot(e).then((e=>e.arrayBuffer()))}function ut(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise(((n,i)=>{t.onload=()=>n(t),t.onerror=()=>i(new Error(`Failed to load image from "${e}"`))}))}I(ot,"fetchURL"),I(at,"fetchJSON"),I(lt,"fetchText"),I(ht,"fetchArrayBuffer"),I(ut,"loadImg");var dt=2.5949095,ct=2.70158,pt=2*Math.PI/3,ft=2*Math.PI/4.5,mt={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>ct*e*e*e-1.70158*e*e,easeOutBack:e=>1+ct*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-dt)/2:(Math.pow(2*e-2,2)*((dt+1)*(2*e-2)+dt)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*pt),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*pt)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*ft)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*ft)/2+1,easeInBounce:e=>1-mt.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-mt.easeOutBounce(1-2*e))/2:(1+mt.easeOutBounce(2*e-1))/2},gt=mt,wt=(I(b=class{constructor(e,t,n){R(this,"textures",[]),R(this,"canvas"),R(this,"c2d"),R(this,"x",0),R(this,"y",0),R(this,"curHeight",0),R(this,"gfx"),this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=n,this.textures=[_e.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(_e.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],n=new L(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,n.x,n.y):this.c2d.drawImage(e,n.x,n.y),t.update(this.canvas),[t,new H(n.x/this.canvas.width,n.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},"TexPacker"),b),At=T("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),yt=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",vt="topleft",Vt="monospace",xt=256,Et="linear",bt=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],St=8192*bt.reduce(((e,t)=>e+t.size),0),Rt="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Mt="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",kt="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",It="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Tt=new Set(["id","require"]),Pt=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Bt(e){switch(e){case"topleft":return new L(-1,-1);case"top":return new L(0,-1);case"topright":return new L(1,-1);case"left":return new L(-1,0);case"center":return new L(0,0);case"right":return new L(1,0);case"botleft":return new L(-1,1);case"bot":return new L(0,1);case"botright":return new L(1,1);default:return e}}function Ct(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Ft(e){return e.createBuffer(1,1,44100)}I(Bt,"anchorPt"),I(Ct,"alignPt"),I(Ft,"createEmptyAudioBuffer");const Dt=I(((e={})=>{let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let n=e.canvas??(()=>{let e=document.createElement("canvas");return t.appendChild(e),e})(),i=e.scale??1,r=e.width&&e.height&&!e.stretch&&!e.letterbox;r?(n.width=e.width*i,n.height=e.height*i):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let s=["outline: none","cursor: default"];if(r){let e=n.width,t=n.height;s.push(`width: ${e}px`),s.push(`height: ${t}px`)}else s.push("width: 100%"),s.push("height: 100%");e.crisp&&(s.push("image-rendering: pixelated"),s.push("image-rendering: crisp-edges")),n.style.cssText=s.join(";");let o=e.pixelDensity||window.devicePixelRatio;n.width*=o,n.height*=o,n.tabIndex=0;let a=document.createElement("canvas");a.width=xt,a.height=xt;let l=a.getContext("2d",{willReadFrequently:!0}),h=Ze({canvas:n,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),u=[],d=h.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),c=it(d,{texFilter:e.texFilter}),p=(()=>{let t=ot(kt,It),n=_e.fromImage(c,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),r=e.width&&e.height?new $e(c,e.width*o*i,e.height*o*i):new $e(c,d.drawingBufferWidth,d.drawingBufferHeight),s=null,a=1;e.background&&(s=G(e.background),a=Array.isArray(e.background)?e.background[3]:1,d.clearColor(s.r/255,s.g/255,s.b/255,a??1)),d.enable(d.BLEND),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);let l=new tt(c,bt,St,12288),h=_e.fromImage(c,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:t,defTex:n,frameBuffer:r,postShader:null,postShaderUniform:null,renderer:l,transform:new K,transformStack:[],bgTex:h,bgColor:s,bgAlpha:a,width:e.width??d.drawingBufferWidth/o/i,height:e.height??d.drawingBufferHeight/o/i,viewport:{x:0,y:0,width:d.drawingBufferWidth,height:d.drawingBufferHeight},fixed:!1}})();const f=class e{constructor(e,t,n={},i=null){R(this,"tex"),R(this,"frames",[new H(0,0,1,1)]),R(this,"anims",{}),R(this,"slice9",null),this.tex=e,t&&(this.frames=t),this.anims=n,this.slice9=i}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,n={}){return"string"==typeof t?e.fromURL(t,n):Promise.resolve(e.fromImage(t,n))}static fromImage(t,n={}){let[i,r]=y.packer.add(t),s=n.frames?n.frames.map((e=>new H(r.x+e.x*r.w,r.y+e.y*r.h,e.w*r.w,e.h*r.h))):Q(n.sliceX||1,n.sliceY||1,r.x,r.y,r.w,r.h);return new e(i,s,n.anims,n.slice9)}static fromURL(t,n={}){return ut(t).then((t=>e.fromImage(t,n)))}};I(f,"SpriteData");let m=f;const g=class e{constructor(e){R(this,"buf"),this.buf=e}static fromArrayBuffer(t){return new Promise(((e,n)=>A.ctx.decodeAudioData(t,e,n))).then((t=>new e(t)))}static fromURL(t){return Me(t)?e.fromArrayBuffer(xe(t)):ht(t).then((t=>e.fromArrayBuffer(t)))}};I(g,"SoundData");let w=g,A=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let n=new w(Ft(e));return e.decodeAudioData(At.buffer.slice(0)).then((e=>{n.buf=e})).catch((e=>{console.error("Failed to load burp: ",e)})),{ctx:e,masterNode:t,burpSnd:n}})(),y={urlPrefix:"",sprites:new st,fonts:new st,bitmapFonts:new st,sounds:new st,shaders:new st,custom:new st,packer:new wt(c,2048,2048),loaded:!1};function v(e){return"string"!=typeof e||Me(e)?e:y.urlPrefix+e}I(v,"fixURL");let V={events:new ye,objEvents:new ye,root:kn([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new L(1),angle:0,shake:0,transform:new K}};function x(e){return y.custom.add(null,e)}function E(){let e=[y.sprites,y.sounds,y.shaders,y.fonts,y.bitmapFonts,y.custom];return e.reduce(((e,t)=>e+t.progress()),0)/e.length}function b(e){return void 0!==e&&(y.urlPrefix=e),y.urlPrefix}function S(e,t){return y.custom.add(e,at(t))}V.root.use(pi()),I(x,"load"),I(E,"loadProgress"),I(b,"loadRoot"),I(S,"loadJSON");const M=class{constructor(e,t={}){if(R(this,"fontface"),R(this,"filter",Et),R(this,"outline",null),R(this,"size",64),this.fontface=e,this.filter=t.filter??Et,this.size=t.size??64,this.size>xt)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:G(0,0,0)},"number"==typeof t.outline?this.outline.width=t.outline:"object"==typeof t.outline&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}};I(M,"FontData");let k=M;function T(e,t,n={}){let i=new FontFace(e,"string"==typeof t?`url(${t})`:t);return document.fonts.add(i),y.fonts.add(e,i.load().catch((e=>{throw new Error(`Failed to load font from "${t}": ${e}`)})).then((e=>new k(e,n))))}function z(e,t,n,i,r={}){return y.bitmapFonts.add(e,ut(t).then((e=>dt(_e.fromImage(c,e,r),n,i,r.chars??yt))))}function Q(e=1,t=1,n=0,i=0,r=1,s=1){let o=[],a=r/e,l=s/t;for(let h=0;h<t;h++)for(let t=0;t<e;t++)o.push(new H(n+t*a,i+h*l,a,l));return o}function te(e,t){return e=v(e),x("string"==typeof t?new Promise(((n,i)=>{at(t).then((t=>{te(e,t).then(n).catch(i)}))})):m.from(e).then((e=>{let n={};for(let i in t){let r=t[i],s=e.frames[0],o=2048*s.w,a=2048*s.h,l=r.frames?r.frames.map((e=>new H(s.x+(r.x+e.x)/o*s.w,s.y+(r.y+e.y)/a*s.h,e.w/o*s.w,e.h/a*s.h))):Q(r.sliceX||1,r.sliceY||1,s.x+r.x/o*s.w,s.y+r.y/a*s.h,r.width/o*s.w,r.height/a*s.h),h=new m(e.tex,l,r.anims);y.sprites.addLoaded(i,h),n[i]=h}return n})))}function ae(e,t={}){let n=document.createElement("canvas"),i=e[0].width,r=e[0].height;n.width=i*e.length,n.height=r;let s=n.getContext("2d");e.forEach(((e,t)=>{e instanceof ImageData?s.putImageData(e,t*i,0):s.drawImage(e,t*i,0)}));let o=s.getImageData(0,0,e.length*i,r);return m.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function pe(e,t,n={sliceX:1,sliceY:1,anims:{}}){return t=v(t),Array.isArray(t)?t.some((e=>"string"==typeof e))?y.sprites.add(e,Promise.all(t.map((e=>"string"==typeof e?ut(e):Promise.resolve(e)))).then((e=>ae(e,n)))):y.sprites.addLoaded(e,ae(t,n)):"string"==typeof t?y.sprites.add(e,m.from(t,n)):y.sprites.addLoaded(e,m.fromImage(t,n))}function ve(e,t){return t=v(t),y.sprites.add(e,new Promise((async e=>{let n="string"==typeof t?await at(t):t,i=await Promise.all(n.frames.map(ut)),r=document.createElement("canvas");r.width=n.width,r.height=n.height*n.frames.length;let s=r.getContext("2d");i.forEach(((e,t)=>{s.drawImage(e,0,t*n.height)})),e(await pe(null,r,{sliceY:n.frames.length,anims:n.anims}))})))}function Ve(e,t,n){t=v(t),n=v(n),"string"==typeof t&&!n&&(n=ke(t)+".json");let i="string"==typeof n?at(n):Promise.resolve(n);return y.sprites.add(e,i.then((e=>{let n=e.meta.size,i=e.frames.map((e=>new H(e.frame.x/n.w,e.frame.y/n.h,e.frame.w/n.w,e.frame.h/n.h))),r={};for(let t of e.meta.frameTags)t.from===t.to?r[t.name]=t.from:r[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return m.from(t,{frames:i,anims:r})})))}function Ce(e,t,n){return y.shaders.addLoaded(e,ot(t,n))}function De(e,t,n){t=v(t),n=v(n);let i=I((e=>e?lt(e):Promise.resolve(null)),"resolveUrl"),r=Promise.all([i(t),i(n)]).then((([e,t])=>ot(e,t)));return y.shaders.add(e,r)}function Ue(e,t){return t=v(t),y.sounds.add(e,"string"==typeof t?w.fromURL(t):w.fromArrayBuffer(t))}function Le(e="bean"){return pe(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function Ne(e){return y.sprites.get(e)}function Oe(e){return y.sounds.get(e)}function Ge(e){return y.fonts.get(e)}function qe(e){return y.bitmapFonts.get(e)}function He(e){return y.shaders.get(e)}function je(e){return y.custom.get(e)}function Ke(e){if("string"==typeof e){let t=Ne(e);if(t)return t;if(E()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof m)return rt.loaded(e);if(e instanceof rt)return e;throw new Error(`Invalid sprite: ${e}`)}function Ye(e){if("string"==typeof e){let t=Oe(e);if(t)return t;if(E()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof w)return rt.loaded(e);if(e instanceof rt)return e;throw new Error(`Invalid sound: ${e}`)}function ze(e){if(!e)return p.defShader;if("string"==typeof e){let t=He(e);if(t)return t.data??t;if(E()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof rt&&e.data?e.data:e}function Je(t){if(!t)return Je(e.font??"monospace");if("string"==typeof t){let e=qe(t),n=Ge(t);if(e)return e.data??e;if(n)return n.data??n;if(document.fonts.check(`64px ${t}`))return t;if(E()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof rt&&t.data?t.data:t}function Qe(e){return void 0!==e&&(A.masterNode.gain.value=e),A.masterNode.gain.value}function We(e,t={}){let n=A.ctx,i=t.paused??!1,r=n.createBufferSource(),s=new Ae,o=n.createGain(),a=t.seek??0,l=0,h=0,u=!1;r.loop=!!t.loop,r.detune.value=t.detune??0,r.playbackRate.value=t.speed??1,r.connect(o),r.onended=()=>{var e;p()>=(null==(e=r.buffer)?void 0:e.duration)&&s.trigger()},o.connect(A.masterNode),o.gain.value=t.volume??1;let d=I((e=>{r.buffer=e.buf,i||(l=n.currentTime,r.start(0,a),u=!0)}),"start"),c=Ye(e);c instanceof rt&&c.onLoad(d);let p=I((()=>{if(!r.buffer)return 0;let e=i?h-l:n.currentTime-l,t=r.buffer.duration;return r.loop?e%t:Math.min(e,t)}),"getTime"),f=I((e=>{let t=n.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(o),t}),"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(i!==e)if(i=e,e)u&&(r.stop(),u=!1),h=n.currentTime;else{r=f(r);let e=h-l;r.start(0,e),u=!0,l=n.currentTime-e,h=0}},get paused(){return i},play(e=0){this.seek(e),this.paused=!1},seek(e){var t;(null==(t=r.buffer)?void 0:t.duration)&&(e>r.buffer.duration||(i?(r=f(r),l=h-e):(r.stop(),r=f(r),l=n.currentTime-e,r.start(0,e),u=!0,h=0)))},set speed(e){r.playbackRate.value=e},get speed(){return r.playbackRate.value},set detune(e){r.detune.value=e},get detune(){return r.detune.value},set volume(e){o.gain.value=Math.max(e,0)},get volume(){return o.gain.value},set loop(e){r.loop=e},get loop(){return r.loop},duration(){var e;return(null==(e=r.buffer)?void 0:e.duration)??0},time(){return p()%this.duration()},onEnd:e=>s.add(e),then(e){return this.onEnd(e)}}}function Xe(e){return We(A.burpSnd,e)}function nt(e,t){return new $e(c,e,t)}function ot(e=kt,t=It){let n=Rt.replace("{{user}}",e??kt),i=Mt.replace("{{user}}",t??It);try{return new et(c,n,i,bt.map((e=>e.name)))}catch(r){let e=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,t=Pe(r).match(e),n=Number(t.groups.line)-14,i=t.groups.msg.trim(),s=t.groups.type.toLowerCase();throw new Error(`${s} shader line ${n}: ${i}`)}}function dt(e,t,n,i){let r=e.width/t,s={},o=i.split("").entries();for(let[a,l]of o)s[l]=new H(a%r*t,Math.floor(a/r)*n,t,n);return{tex:e,map:s,size:n}}function ct(e,t,n,i=p.defTex,r=p.defShader,s={}){let o=ze(r);if(!o||o instanceof rt)return;let a=p.fixed||n?p.transform:V.cam.transform.mult(p.transform),l=[];for(let h of e){let e=Ut(a.multVec2(h.pos));l.push(e.x,e.y,h.uv.x,h.uv.y,h.color.r/255,h.color.g/255,h.color.b/255,h.opacity)}p.renderer.push(d.TRIANGLES,l,t,o,i,s)}function pt(){p.renderer.flush()}function ft(){d.clear(d.COLOR_BUFFER_BIT),p.frameBuffer.bind(),d.clear(d.COLOR_BUFFER_BIT),p.bgColor||sn((()=>{jt({width:pn(),height:fn(),quad:new H(0,0,pn()/64,fn()/64),tex:p.bgTex,fixed:!0})})),p.renderer.numDraws=0,p.fixed=!1,p.transformStack.length=0,p.transform=new K}function mt(e,t){p.postShader=e,p.postShaderUniform=t??null}function Dt(){pt(),p.lastDrawCalls=p.renderer.numDraws,p.frameBuffer.unbind(),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight);let e=p.width,t=p.height;p.width=d.drawingBufferWidth/o,p.height=d.drawingBufferHeight/o,Kt({flipY:!0,tex:p.frameBuffer.tex,pos:new L(p.viewport.x,p.viewport.y),width:p.viewport.width,height:p.viewport.height,shader:p.postShader,uniform:"function"==typeof p.postShaderUniform?p.postShaderUniform():p.postShaderUniform,fixed:!0}),pt(),p.width=e,p.height=t}function Ut(e){return new L(e.x/pn()*2-1,-e.y/fn()*2+1)}function Lt(e){p.transform=e.clone()}function Nt(...e){if(void 0===e[0])return;let t=N(...e);0===t.x&&0===t.y||p.transform.translate(t)}function Ot(...e){if(void 0===e[0])return;let t=N(...e);1===t.x&&1===t.y||p.transform.scale(t)}function Gt(e){e&&p.transform.rotate(e)}function qt(){p.transformStack.push(p.transform.clone())}function Ht(){p.transformStack.length>0&&(p.transform=p.transformStack.pop())}function jt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,i=Bt(e.anchor||vt).scale(new L(t,n).scale(-.5)),r=e.quad||new H(0,0,1,1),s=e.color||G(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,l=e.tex?.1/e.tex.height:0,h=r.x+a,u=r.y+l,d=r.w-2*a,c=r.h-2*l;qt(),Nt(e.pos),Gt(e.angle),Ot(e.scale),Nt(i),ct([{pos:new L(-t/2,n/2),uv:new L(e.flipX?h+d:h,e.flipY?u:u+c),color:s,opacity:o},{pos:new L(-t/2,-n/2),uv:new L(e.flipX?h+d:h,e.flipY?u+c:u),color:s,opacity:o},{pos:new L(t/2,-n/2),uv:new L(e.flipX?h:h+d,e.flipY?u+c:u),color:s,opacity:o},{pos:new L(t/2,n/2),uv:new L(e.flipX?h:h+d,e.flipY?u:u+c),color:s,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),Ht()}function Kt(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new H(0,0,1,1),n=e.tex.width*t.w,i=e.tex.height*t.h,r=new L(1);if(e.tiled){let s=Math.ceil((e.width||n)/n),o=Math.ceil((e.height||i)/i),a=Bt(e.anchor||vt).add(new L(1,1)).scale(.5).scale(s*n,o*i);for(let l=0;l<s;l++)for(let s=0;s<o;s++)jt(Object.assign({},e,{pos:(e.pos||new L(0)).add(new L(n*l,i*s)).sub(a),scale:r.scale(e.scale||new L(1)),tex:e.tex,quad:t,width:n,height:i,anchor:"topleft"}))}else e.width&&e.height?(r.x=e.width/n,r.y=e.height/i):e.width?(r.x=e.width/n,r.y=r.x):e.height&&(r.y=e.height/i,r.x=r.y),jt(Object.assign({},e,{scale:r.scale(e.scale||new L(1)),tex:e.tex,quad:t,width:n,height:i}))}function Yt(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=Ke(e.sprite);if(!t||!t.data)return;let n=t.data.frames[e.frame??0];if(!n)throw new Error(`Frame not found: ${e.frame??0}`);Kt(Object.assign({},e,{tex:t.data.tex,quad:n.scale(e.quad??new H(0,0,1,1))}))}function zt(e,t,n,i,r,s=1){i=P(i%360),(r=P(r%360))<=i&&(r+=2*Math.PI);let o=[],a=(r-i)/Math.ceil((r-i)/P(8)*s);for(let l=i;l<r;l+=a)o.push(e.add(t*Math.cos(l),n*Math.sin(l)));return o.push(e.add(t*Math.cos(r),n*Math.sin(r))),o}function Jt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,i=Bt(e.anchor||vt).add(1,1).scale(new L(t,n).scale(-.5)),r=[new L(0,0),new L(t,0),new L(t,n),new L(0,n)];if(e.radius){let i=Math.min(Math.min(t,n)/2,e.radius);r=[new L(i,0),new L(t-i,0),...zt(new L(t-i,i),i,i,270,360),new L(t,i),new L(t,n-i),...zt(new L(t-i,n-i),i,i,0,90),new L(t-i,n),new L(i,n),...zt(new L(i,n-i),i,i,90,180),new L(0,n-i),new L(0,i),...zt(new L(i,i),i,i,180,270)]}$t(Object.assign({},e,{offset:i,pts:r,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function Qt(e){let{p1:t,p2:n}=e;if(!t||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let i=e.width||1,r=n.sub(t).unit().normal().scale(.5*i);ct([t.sub(r),t.add(r),n.add(r),n.sub(r)].map((t=>({pos:new L(t.x,t.y),uv:new L(0),color:e.color??O.WHITE,opacity:e.opacity??1}))),[0,1,3,1,2,3],e.fixed,p.defTex,e.shader,e.uniform)}function Wt(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let n=t[0].sdist(t[1]);for(let e=1;e<t.length-1;e++)n=Math.min(t[e].sdist(t[e+1]),n);Math.min(e.radius,Math.sqrt(n)/2),Qt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let i=1;i<t.length-2;i++){let n=t[i],r=t[i+1];Qt(Object.assign({},e,{p1:n,p2:r}))}Qt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let n=0;n<t.length-1;n++)Qt(Object.assign({},e,{p1:t[n],p2:t[n+1]})),"none"!==e.join&&Zt(Object.assign({},e,{pos:t[n],radius:e.width/2}))}function Xt(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return $t(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function Zt(e){if("number"!=typeof e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&_t(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function _t(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,n=e.end??360,i=Bt(e.anchor??"center").scale(new L(-e.radiusX,-e.radiusY)),r=zt(i,e.radiusX,e.radiusY,t,n,e.resolution);r.unshift(i);let s=Object.assign({},e,{pts:r,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(r.length-1).fill(e.gradient[1])]}:{}});if(n-t>=360&&e.outline)return!1!==e.fill&&$t(Object.assign(s,{outline:null})),void $t(Object.assign(s,{pts:r.slice(1),fill:!1}));$t(s)}function $t(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(qt(),Nt(e.pos),Ot(e.scale),Gt(e.angle),Nt(e.offset),!1!==e.fill){let n=e.color??O.WHITE,i=e.pts.map(((t,i)=>({pos:new L(t.x,t.y),uv:new L(0,0),color:e.colors&&e.colors[i]?e.colors[i].mult(n):n,opacity:e.opacity??1}))),r=[...Array(t-2).keys()].map((e=>[0,e+1,e+2])).flat();ct(i,e.indices??r,e.fixed,p.defTex,e.shader,e.uniform)}e.outline&&Wt({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),Ht()}}function en(e,t,n){pt(),d.clear(d.STENCIL_BUFFER_BIT),d.enable(d.STENCIL_TEST),d.stencilFunc(d.NEVER,1,255),d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE),t(),pt(),d.stencilFunc(n,1,255),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),e(),pt(),d.disable(d.STENCIL_TEST)}function tn(e,t){en(e,t,d.EQUAL)}function nn(e,t){en(e,t,d.NOTEQUAL)}function rn(){return(p.viewport.width+p.viewport.height)/(p.width+p.height)}function sn(e){pt();let t=p.width,n=p.height;p.width=p.viewport.width,p.height=p.viewport.height,e(),pt(),p.width=t,p.height=n}function on(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(N(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&1===e.ch.length&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}I(T,"loadFont"),I(z,"loadBitmapFont"),I(Q,"slice"),I(te,"loadSpriteAtlas"),I(ae,"createSpriteSheet"),I(pe,"loadSprite"),I(ve,"loadPedit"),I(Ve,"loadAseprite"),I(Ce,"loadShader"),I(De,"loadShaderURL"),I(Ue,"loadSound"),I(Le,"loadBean"),I(Ne,"getSprite"),I(Oe,"getSound"),I(Ge,"getFont"),I(qe,"getBitmapFont"),I(He,"getShader"),I(je,"getAsset"),I(Ke,"resolveSprite"),I(Ye,"resolveSound"),I(ze,"resolveShader"),I(Je,"resolveFont"),I(Qe,"volume"),I(We,"play"),I(Xe,"burp"),I(nt,"makeCanvas"),I(ot,"makeShader"),I(dt,"makeFont"),I(ct,"drawRaw"),I(pt,"flush"),I(ft,"frameStart"),I(mt,"usePostEffect"),I(Dt,"frameEnd"),I(Ut,"screen2ndc"),I(Lt,"pushMatrix"),I(Nt,"pushTranslate"),I(Ot,"pushScale"),I(Gt,"pushRotate"),I(qt,"pushTransform"),I(Ht,"popTransform"),I(jt,"drawUVQuad"),I(Kt,"drawTexture"),I(Yt,"drawSprite"),I(zt,"getArcPts"),I(Jt,"drawRect"),I(Qt,"drawLine"),I(Wt,"drawLines"),I(Xt,"drawTriangle"),I(Zt,"drawCircle"),I(_t,"drawEllipse"),I($t,"drawPolygon"),I(en,"drawStenciled"),I(tn,"drawMasked"),I(nn,"drawSubtracted"),I(rn,"getViewportScale"),I(sn,"drawUnscaled"),I(on,"applyCharTransform");let an=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function ln(e){let t={},n=e.replace(an,"$2"),i=0;for(let r of e.matchAll(an)){let e=r.index-i;for(let n=0;n<r.groups.text.length;n++)t[n+e]=[r.groups.style];i+=r[0].length-r.groups.text.length}return{charStyleMap:t,text:n}}I(ln,"compileStyledText");let hn={};function un(e){var t,n;if(void 0===e.text)throw new Error('formatText() requires property "text".');let i=Je(e.font);if(""===e.text||i instanceof rt||!i)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:r,text:s}=ln(e.text+""),o=Fe(s);if(i instanceof k||"string"==typeof i){let e=i instanceof k?i.fontface.family:i,r=i instanceof k?{outline:i.outline,filter:i.filter}:{outline:null,filter:Et},s=hn[e]??{font:{tex:new _e(c,2048,2048,{filter:r.filter}),map:{},size:64},cursor:new L(0),outline:r.outline};hn[e]||(hn[e]=s),i=s.font;for(let h of o)if(!s.font.map[h]){let r=l;r.clearRect(0,0,a.width,a.height),r.font=`${i.size}px ${e}`,r.textBaseline="top",r.textAlign="left",r.fillStyle="#ffffff";let o=r.measureText(h),u=Math.ceil(o.width),d=i.size;s.outline&&(r.lineJoin="round",r.lineWidth=2*s.outline.width,r.strokeStyle=s.outline.color.toHex(),r.strokeText(h,s.outline.width,s.outline.width),u+=2*s.outline.width,d+=3*s.outline.width),r.fillText(h,(null==(t=s.outline)?void 0:t.width)??0,(null==(n=s.outline)?void 0:n.width)??0);let c=r.getImageData(0,0,u,d);if(s.cursor.x+u>2048&&(s.cursor.x=0,s.cursor.y+=d,s.cursor.y>2048))throw new Error("Font atlas exceeds character limit");i.tex.update(c,s.cursor.x,s.cursor.y),i.map[h]=new H(s.cursor.x,s.cursor.y,u,d),s.cursor.x+=u}}let h=e.size||i.size,u=N(e.scale??1).scale(h/i.size),d=e.lineSpacing??0,p=e.letterSpacing??0,f=0,m=0,g=0,w=[],A=[],y=0,v=null,V=null;for(;y<o.length;){let t=o[y];if("\n"===t)g+=h+d,w.push({width:f-p,chars:A}),v=null,V=null,f=0,A=[];else{let n=i.map[t];if(n){let r=n.w*u.x;e.width&&f+r>e.width&&(g+=h+d,null!=v&&(y-=A.length-v,t=o[y],n=i.map[t],r=n.w*u.x,A=A.slice(0,v-1),f=V),v=null,V=null,w.push({width:f-p,chars:A}),f=0,A=[]),A.push({tex:i.tex,width:n.w,height:n.h,quad:new H(n.x/i.tex.width,n.y/i.tex.height,n.w/i.tex.width,n.h/i.tex.height),ch:t,pos:new L(f,g),opacity:e.opacity??1,color:e.color??O.WHITE,scale:N(u),angle:0})," "===t&&(v=A.length,V=f),f+=r,m=Math.max(m,f),f+=p}}y++}w.push({width:f-p,chars:A}),g+=h,e.width&&(m=e.width);let x=[];for(let a of w){let t=(m-a.width)*Ct(e.align??"left");for(let n of a.chars){let s=i.map[n.ch],o=x.length;if(n.pos=n.pos.add(t,0).add(s.w*u.x*.5,s.h*u.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(o,n.ch):e.transform;t&&on(n,t)}if(r[o]){let t=r[o];for(let i of t){let t=e.styles[i],r="function"==typeof t?t(o,n.ch):t;r&&on(n,r)}}x.push(n)}}return{width:m,height:g,chars:x,opt:e}}function dn(e){cn(un(e))}function cn(e){qt(),Nt(e.opt.pos),Gt(e.opt.angle),Nt(Bt(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach((t=>{jt({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})})),Ht()}function pn(){return p.width}function fn(){return p.height}function mn(e){return new L((e.x-p.viewport.x)*pn()/p.viewport.width,(e.y-p.viewport.y)*fn()/p.viewport.height)}function gn(e){return new L(e.x*p.viewport.width/p.width,e.y*p.viewport.height/p.height)}function wn(){return mn(h.mousePos())}I(un,"formatText"),I(dn,"drawText"),I(cn,"drawFormattedText"),I(pn,"width"),I(fn,"height"),I(mn,"windowToContent"),I(gn,"contentToView"),I(wn,"mousePos");let An=!1,yn={inspect:!1,timeScale:1,showLog:!0,fps:()=>h.fps(),numFrames:()=>h.numFrames(),stepFrame:_i,drawCalls:()=>p.lastDrawCalls,clearLog:()=>V.logs=[],log:t=>{let n=e.logMax??8;V.logs.unshift({msg:t,time:h.time()}),V.logs.length>n&&(V.logs=V.logs.slice(0,n))},error:e=>yn.log(new Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Ki("*",{recursive:!0}).length,get paused(){return An},set paused(e){An=e,e?A.ctx.suspend():A.ctx.resume()}};function vn(){return h.dt()*yn.timeScale}function Vn(...e){return e.length>0&&(V.cam.pos=N(...e)),V.cam.pos?V.cam.pos.clone():Ci()}function xn(...e){return e.length>0&&(V.cam.scale=N(...e)),V.cam.scale.clone()}function En(e){return void 0!==e&&(V.cam.angle=e),V.cam.angle}function bn(e=12){V.cam.shake+=e}function Sn(e){return V.cam.transform.multVec2(e)}function Rn(e){return V.cam.transform.invert().multVec2(e)}function Mn(e){let t=new K;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function kn(e=[]){let t=new Map,n={},i=new ye,r=[],s=null,o=!1,a={id:Te(),hidden:!1,transform:new K,children:[],parent:null,set paused(e){if(e!==o){o=e;for(let t of r)t.paused=e}},get paused(){return o},add(e=[]){let t=Array.isArray(e)?kn(e):e;if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t.parent=this,t.transform=Mn(t),this.children.push(t),t.trigger("add",t),V.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);if(-1!==t){e.parent=null,this.children.splice(t,1);let n=I((e=>{e.trigger("destroy"),V.events.trigger("destroy",e),e.children.forEach((e=>n(e)))}),"trigger");n(e)}},removeAll(e){if(e)this.get(e).forEach((e=>this.remove(e)));else for(let t of[...this.children])this.remove(t)},update(){this.paused||(this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.update())),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let e=p.fixed;this.fixed&&(p.fixed=!0),qt(),Nt(this.pos),Ot(this.scale),Gt(this.angle);let t=this.children.sort(((e,t)=>(e.z??0)-(t.z??0)));if(this.mask){let e={intersect:tn,subtract:nn}[this.mask];if(!e)throw new Error(`Invalid mask func: "${this.mask}"`);e((()=>{t.forEach((e=>e.draw()))}),(()=>{this.trigger("draw")}))}else this.trigger("draw"),t.forEach((e=>e.draw()));Ht(),p.fixed=e,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(qt(),Nt(this.pos),Ot(this.scale),Gt(this.angle),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.drawInspect())),this.trigger("drawInspect"),Ht())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let i=[];e.id&&(this.unuse(e.id),n[e.id]=[],i=n[e.id],t.set(e.id,e));for(let t in e){if(Tt.has(t))continue;let n=Object.getOwnPropertyDescriptor(e,t);if("function"==typeof n.value&&(e[t]=e[t].bind(this)),n.set&&Object.defineProperty(e,t,{set:n.set.bind(this)}),n.get&&Object.defineProperty(e,t,{get:n.get.bind(this)}),Pt.has(t)){let n="add"===t?()=>{s=I((e=>i.push(e)),"onCurCompCleanup"),e[t](),s=null}:e[t];i.push(this.on(t,n).cancel)}else{if(void 0!==this[t])throw new Error(`Duplicate component property: "${t}"`);Object.defineProperty(this,t,{get:()=>e[t],set:n=>e[t]=n,configurable:!0,enumerable:!0}),i.push((()=>delete this[t]))}}let r=I((()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)}),"checkDeps");e.destroy&&i.push(e.destroy.bind(this)),this.exists()?(r(),e.add&&(s=I((e=>i.push(e)),"onCurCompCleanup"),e.add.call(this),s=null)):e.require&&i.push(this.on("add",r).cancel)},unuse(e){n[e]&&(n[e].forEach((e=>e())),delete n[e]),t.has(e)&&t.delete(e)},c:e=>t.get(e),get(e,t={}){let n=t.recursive?this.children.flatMap(I((function e(t){return[t,...t.children.flatMap(e)]}),"recurse")):this.children;if(n=n.filter((t=>!e||t.is(e))),t.liveUpdate){let i=I((e=>t.recursive?this.isAncestorOf(e):e.parent===this),"isChild"),r=[];r.push(Bn((t=>{i(t)&&t.is(e)&&n.push(t)}))),r.push(Cn((t=>{if(i(t)&&t.is(e)){let e=n.findIndex((e=>e.id===t.id));-1!==e&&n.splice(e,1)}}))),this.onDestroy((()=>{for(let e of r)e.cancel()}))}return n},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return V.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let n=i.on(e,t.bind(this));return s&&s((()=>n.cancel())),n},trigger(e,...t){i.trigger(e,...t),V.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[n,i]of t)e[n]=i.inspect?i.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){i.clear()}},l=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let u of l)a[u]=(...e)=>{let t=h[u](...e);return r.push(t),a.onDestroy((()=>t.cancel())),t};for(let h of e)a.use(h);return a}function In(e,t,n){return V.objEvents[e]||(V.objEvents[e]=new ge),V.objEvents.on(e,((e,...i)=>{e.is(t)&&n(e,...i)}))}I(vn,"dt"),I(Vn,"camPos"),I(xn,"camScale"),I(En,"camRot"),I(bn,"shake"),I(Sn,"toScreen"),I(Rn,"toWorld"),I(Mn,"calcTransform"),I(kn,"make"),I(In,"on");let Tn=Ie((e=>{let t=qi([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}}),((e,t)=>In("update",e,t))),Pn=Ie((e=>{let t=qi([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}}),((e,t)=>In("draw",e,t))),Bn=Ie((e=>V.events.on("add",e)),((e,t)=>In("add",e,t))),Cn=Ie((e=>V.events.on("destroy",e)),((e,t)=>In("destroy",e,t)));function Fn(e,t,n){return In("collide",e,((e,i,r)=>i.is(t)&&n(e,i,r)))}function Dn(e,t,n){return In("collideUpdate",e,((e,i,r)=>i.is(t)&&n(e,i,r)))}function Un(e,t,n){return In("collideEnd",e,((e,i,r)=>i.is(t)&&n(e,i,r)))}function Ln(e,t){Ki(e,{recursive:!0}).forEach(t),Bn(e,t)}I(Fn,"onCollide"),I(Dn,"onCollideUpdate"),I(Un,"onCollideEnd"),I(Ln,"forAllCurrentAndFuture");let Nn=Ie((e=>h.onMousePress(e)),((e,t)=>{let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");n.push(e.onClick((()=>t(e))))})),we.join(n)}));function On(e,t){let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");n.push(e.onHover((()=>t(e))))})),we.join(n)}function Gn(e,t){let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(e.onHoverUpdate((()=>t(e))))})),we.join(n)}function qn(e,t){let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(e.onHoverEnd((()=>t(e))))})),we.join(n)}function Hn(e){V.gravity=e}function jn(){return V.gravity}function Kn(...e){1===e.length||2===e.length?(p.bgColor=G(e[0]),e[1]&&(p.bgAlpha=e[1])):(3===e.length||4===e.length)&&(p.bgColor=G(e[0],e[1],e[2]),e[3]&&(p.bgAlpha=e[3])),d.clearColor(p.bgColor.r/255,p.bgColor.g/255,p.bgColor.b/255,p.bgAlpha)}function Yn(){return p.bgColor.clone()}function zn(...e){return{id:"pos",pos:N(...e),moveBy(...e){this.pos=this.pos.add(N(...e))},move(...e){this.moveBy(N(...e).scale(vn()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(N(e[0],e[1]),e[2]);let t=e[0],n=e[1];if(void 0===n)return void(this.pos=N(t));let i=t.sub(this.pos);i.len()<=n*vn()?this.pos=N(t):this.move(i.unit().scale(n))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let e=this.worldPos();return ii(this)?e:Sn(e)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Zt({color:G(255,0,0),radius:4/rn()})}}}function Jn(...e){return 0===e.length?Jn(1):{id:"scale",scale:N(...e),scaleTo(...e){this.scale=N(...e)},scaleBy(...e){this.scale.scale(N(...e))},inspect(){return`(${Xn(this.scale.x,2)}, ${Xn(this.scale.y,2)})`}}}function Qn(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function Wn(...e){return{id:"color",color:G(...e),inspect(){return this.color.toString()}}}function Xn(e,t){return Number(e.toFixed(t))}function Zn(e){return{id:"opacity",opacity:e??1,inspect(){return`${Xn(this.opacity,1)}`},fadeOut(e=1,t=gt.linear){return Ji(this.opacity,0,e,(e=>this.opacity=e),t)}}}function _n(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function $n(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function ei(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??N(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function ti(e,t){let n="number"==typeof e?L.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(t))}}}I(On,"onHover"),I(Gn,"onHoverUpdate"),I(qn,"onHoverEnd"),I(Hn,"setGravity"),I(jn,"getGravity"),I(Kn,"setBackground"),I(Yn,"getBackground"),I(zn,"pos"),I(Jn,"scale"),I(Qn,"rotate"),I(Wn,"color"),I(Xn,"toFixed"),I(Zn,"opacity"),I(_n,"anchor"),I($n,"z"),I(ei,"follow"),I(ti,"move");function ni(e={}){let t=e.distance??200,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=this.screenPos(),n=new de(N(0),pn(),fn());return!re(n,e)&&n.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function ii(e){return!!e.fixed||!!e.parent&&ii(e.parent)}function ri(e={}){let t={},n=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover((()=>h.setCursor(this.area.cursor))),this.onCollideUpdate(((e,i)=>{t[e.id]||this.trigger("collide",e,i),t[e.id]=i,n.add(e.id)}))},update(){for(let e in t)n.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);n.clear()},drawInspect(){let e=this.localArea();qt(),Ot(this.area.scale),Nt(this.area.offset);let t={outline:{width:4/rn(),color:G(0,0,255)},anchor:this.anchor,fill:!1,fixed:ii(this)};e instanceof de?Jt({...t,pos:e.pos,width:e.width,height:e.height}):e instanceof fe?$t({...t,pts:e.pts}):e instanceof ce&&Zt({...t,pos:e.center,radius:e.radius}),Ht()},area:{shape:e.shape??null,scale:e.scale?N(e.scale):N(1),offset:e.offset??N(0),cursor:e.cursor??null},isClicked(){return h.isMousePressed()&&this.isHovering()},isHovering(){let e=ii(this)?wn():Rn(wn());return this.hasPoint(e)},checkCollision:e=>t[e.id]??null,getCollisions:()=>Object.values(t),isColliding:e=>!!t[e.id],isOverlapping(e){let n=t[e.id];return n&&n.hasOverlap()},onClick(e){let t=h.onMousePress("left",(()=>{this.isHovering()&&e()}));return this.onDestroy((()=>t.cancel())),t},onHover(e){let t=!1;return this.onUpdate((()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())}))},onHoverUpdate(e){return this.onUpdate((()=>{this.isHovering()&&e()}))},onHoverEnd(e){let t=!1;return this.onUpdate((()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()}))},onCollide(e,t){return"function"==typeof e&&void 0===t?this.on("collide",e):"string"==typeof e?this.onCollide(((n,i)=>{n.is(e)&&t(n,i)})):void 0},onCollideUpdate(e,t){return"function"==typeof e&&void 0===t?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",((n,i)=>n.is(e)&&t(n,i))):void 0},onCollideEnd(e,t){return"function"==typeof e&&void 0===t?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",(n=>n.is(e)&&t(n))):void 0},hasPoint(e){return he(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof fe||e instanceof de))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(N(this.area.scale??1)).translate(this.area.offset);if(e instanceof de){let n=Bt(this.anchor||vt).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(n)}return e.transform(t)},screenArea(){let e=this.worldArea();return ii(this)?e:e.transform(V.cam.transform)}}}function si(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function oi(e,t={}){let n=null,i=null,r=null,s=new Ae;if(!e)throw new Error("Please pass the resource name or data to sprite()");let o=I(((e,t,n,i)=>{let r=N(1,1);return n&&i?(r.x=n/(e.width*t.w),r.y=i/(e.height*t.h)):n?(r.x=n/(e.width*t.w),r.y=r.x):i&&(r.y=i/(e.height*t.h),r.x=r.y),r}),"calcTexScale");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new H(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,draw(){if(!n)return;let e=n.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:i,right:r,top:s,bottom:o}=n.slice9,a=n.tex.width*e.w,l=n.tex.height*e.h,h=this.width-i-r,u=this.height-s-o,d=i/a,c=r/a,p=1-d-c,f=s/l,m=o/l,g=1-f-m,w=[j(0,0,d,f),j(d,0,p,f),j(d+p,0,c,f),j(0,f,d,g),j(d,f,p,g),j(d+p,f,c,g),j(0,f+g,d,m),j(d,f+g,p,m),j(d+p,f+g,c,m),j(0,0,i,s),j(i,0,h,s),j(i+h,0,r,s),j(0,s,i,u),j(i,s,h,u),j(i+h,s,r,u),j(0,s+u,i,o),j(i,s+u,h,o),j(i+h,s+u,r,o)];for(let A=0;A<9;A++){let i=w[A],r=w[A+9];Kt(Object.assign(si(this),{pos:r.pos(),tex:n.tex,quad:e.scale(i),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:r.w,height:r.h}))}}else Kt(Object.assign(si(this),{tex:n.tex,quad:e.scale(this.quad??new H(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let i=I((e=>{let i=e.frames[0].clone();t.quad&&(i=i.scale(t.quad));let r=o(e.tex,i,t.width,t.height);this.width=e.tex.width*i.w*r.x,this.height=e.tex.height*i.h*r.y,t.anim&&this.play(t.anim),n=e,s.trigger(n)}),"setSpriteData"),r=Ke(e);r?r.onLoad(i):Ri((()=>i(Ke(e).data)))},update(){if(!i)return;let e=n.anims[i.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");i.timer+=vn()*this.animSpeed,i.timer>=1/i.speed&&(i.timer=0,this.frame+=r,(this.frame<Math.min(e.from,e.to)||this.frame>Math.max(e.from,e.to))&&(i.loop?i.pingpong?(this.frame-=r,r*=-1,this.frame+=r):this.frame=e.from:(this.frame=e.to,i.onEnd(),this.stop())))}else this.frame=e},play(e,t={}){if(!n)return void s.add((()=>this.play(e,t)));let o=n.anims[e];if(void 0===o)throw new Error(`Anim not found: ${e}`);i&&this.stop(),i="number"==typeof o?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??o.loop??!1,pingpong:t.pingpong??o.pingpong??!1,speed:t.speed??o.speed??10,onEnd:t.onEnd??(()=>{})},r="number"==typeof o?null:o.from<o.to?1:-1,this.frame="number"==typeof o?o:o.from,this.trigger("animStart",e)},stop(){if(!i)return;let e=i.name;i=null,this.trigger("animEnd",e)},numFrames:()=>(null==n?void 0:n.frames.length)??0,curAnim:()=>null==i?void 0:i.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new de(N(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function ai(e,t={}){function n(e){var n,i;let r=un(Object.assign(si(e),{text:e.text+"",size:e.textSize,font:e.font,width:t.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return t.width||(e.width=r.width/((null==(n=e.scale)?void 0:n.x)||1)),e.height=r.height/((null==(i=e.scale)?void 0:i.y)||1),r}I(n,"update");let i={id:"text",set text(t){e=t,n(this)},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,add(){Ri((()=>n(this)))},draw(){cn(n(this))},renderArea(){return new de(N(0),this.width,this.height)}};return n(i),i}function li(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,radius:t.radius,draw(){$t(Object.assign(si(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:t.fill}))},renderArea(){return new fe(this.pts)},inspect(){return this.pts.map((e=>`[${e.x},${e.y}]`)).join(",")}}}function hi(e,t,n={}){return{id:"rect",width:e,height:t,radius:n.radius||0,draw(){Jt(Object.assign(si(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new de(N(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function ui(e,t){return{id:"rect",width:e,height:t,draw(){jt(Object.assign(si(this),{width:this.width,height:this.height}))},renderArea(){return new de(N(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function di(e,t={}){return{id:"circle",radius:e,draw(){Zt(Object.assign(si(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new de(new L(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function ci(e=1,t=G(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}function pi(){return{id:"timer",wait(e,t){let n=[];t&&n.push(t);let i=0,r=this.onUpdate((()=>{i+=vn(),i>=e&&(n.forEach((e=>e())),r.cancel())}));return{get paused(){return r.paused},set paused(e){r.paused=e},cancel:r.cancel,onEnd(e){n.push(e)},then(e){return this.onEnd(e),this}}},loop(e,t){let n=null,i=I((()=>{n=this.wait(e,i),t()}),"newAction");return n=this.wait(0,i),{get paused(){return n.paused},set paused(e){n.paused=e},cancel:()=>n.cancel()}},tween(e,t,n,i,r=gt.linear){let s=0,o=[],a=this.onUpdate((()=>{s+=vn();let l=Math.min(s/n,1);i(F(e,t,r(l))),1===l&&(a.cancel(),i(t),o.forEach((e=>e())))}));return{get paused(){return a.paused},set paused(e){a.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){a.cancel()},finish(){a.cancel(),i(t),o.forEach((e=>e()))}}}}}I(ni,"offscreen"),I(ii,"isFixed"),I(ri,"area"),I(si,"getRenderProps"),I(oi,"sprite"),I(ai,"text"),I(li,"polygon"),I(hi,"rect"),I(ui,"uvquad"),I(di,"circle"),I(ci,"outline"),I(pi,"timer");let fi;function mi(e={}){let t=null,n=null,i=!1;return{id:"body",require:["pos","area"],vel:new L(0),jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw new Error("Can't set body mass to 0");this.onCollideUpdate(((e,t)=>{if(e.is("body")&&!t.resolved&&(this.trigger("beforePhysicsResolve",t),e.trigger("beforePhysicsResolve",t.reverse()),!(t.resolved||this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let n=!this.isStatic&&e.isStatic?t:t.reverse();n.source.pos=n.source.pos.add(n.displacement),n.source.transform=Mn(n.source)}else{let n=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/n)),e.pos=e.pos.add(t.displacement.scale(-this.mass/n)),this.transform=Mn(this),e.transform=Mn(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}})),this.onPhysicsResolve((e=>{V.gravity&&(e.isBottom()&&this.isFalling()?(this.vel.y=0,t=e.target,n=e.target.pos,i?i=!1:this.trigger("ground",t)):e.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",e.target)))}))},update(){if(!V.gravity||this.isStatic)return;if(i&&(t=null,n=null,this.trigger("fallOff"),i=!1),t){if(this.isColliding(t)&&t.exists()&&t.is("body"))return!t.pos.eq(n)&&!1!==e.stickToPlatform&&this.moveBy(t.pos.sub(n)),void(n=t.pos);i=!0}let r=this.vel.y;this.vel.y+=V.gravity*this.gravityScale*vn(),this.vel.y=Math.min(this.vel.y,e.maxVelocity??65536),r<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>t,isGrounded:()=>null!==t,isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(e){t=null,n=null,this.vel.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function gi(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround((()=>{t=this.numJumps}))},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${t}`}}function wi(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t}}}function Ai(){return{id:"fixed",fixed:!0}}function yi(e){return{id:"stay",stay:!0,scenesToStay:e}}function vi(e,t){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){let n=e;this.setHP(e+t),this.trigger("heal",e-n)},hp:()=>e,maxHP:()=>t??null,setMaxHP(e){t=e},setHP(n){(e=t?Math.min(t,n):n)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function Vi(e,t={}){if(null==e)throw new Error("lifespan() requires time");let n=t.fade??0;return{id:"lifespan",async add(){await Yi(e),n>0&&this.opacity&&await Ji(this.opacity,0,n,(e=>this.opacity=e),gt.linear),this.destroy()}}}function xi(e,t,n){if(!e)throw new Error("state() requires an initial state");let i={};function r(e){i[e]||(i[e]={enter:new Ae,end:new Ae,update:new Ae,draw:new Ae})}function s(e,t,n){return r(t),i[t][e].add(n)}function o(e,t,...n){r(t),i[t][e].trigger(...n)}I(r,"initStateEvents"),I(s,"on"),I(o,"trigger");let a=!1;return{id:"state",state:e,enterState(e,...i){if(a=!0,t&&!t.includes(e))throw new Error(`State not found: ${e}`);let r=this.state;if(n){if(!(null==n?void 0:n[r]))return;let t="string"==typeof n[r]?[n[r]]:n[r];if(!t.includes(e))throw new Error(`Cannot transition state from "${r}" to "${e}". Available transitions: ${t.map((e=>`"${e}"`)).join(", ")}`)}o("end",r,...i),this.state=e,o("enter",e,...i),o("enter",`${r} -> ${e}`,...i)},onStateTransition:(e,t,n)=>s("enter",`${e} -> ${t}`,n),onStateEnter:(e,t)=>s("enter",e,t),onStateUpdate:(e,t)=>s("update",e,t),onStateDraw:(e,t)=>s("draw",e,t),onStateEnd:(e,t)=>s("end",e,t),update(){a||(o("enter",e),a=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return this.state}}}function Ei(e=1){let t=0,n=!1;return{require:["opacity"],add(){this.opacity=0},update(){n||(t+=vn(),this.opacity=D(t,0,e,0,1),t>=e&&(this.opacity=1,n=!0))}}}function bi(e="intersect"){return{id:"mask",mask:e}}function Si(e){return{add(){this.canvas=e}}}function Ri(e){y.loaded?e():V.events.on("load",e)}function Mi(e,t){V.scenes[e]=t}function ki(e,...t){if(!V.scenes[e])throw new Error(`Scene not found: ${e}`);V.events.onOnce("frameEnd",(()=>{V.events.trigger("sceneLeave",e),h.events.clear(),V.events.clear(),V.objEvents.clear(),[...V.root.children].forEach((t=>{(!t.stay||t.scenesToStay&&!t.scenesToStay.includes(e))&&V.root.remove(t)})),V.root.clearEvents(),fr(),V.cam={pos:null,scale:N(1),angle:0,shake:0,transform:new K},V.scenes[e](...t)}))}function Ii(e){return V.events.on("sceneLeave",e)}function Ti(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(Pi(e,t),t):null}}function Pi(e,t){window.localStorage[e]=JSON.stringify(t)}function Bi(t,...n){let i,r=t(mr);i="function"==typeof r?r(...n)(mr):r;for(let s in i)mr[s]=i[s],!1!==e.global&&(window[s]=i[s]);return mr}function Ci(){return N(pn()/2,fn()/2)}var Fi;function Di(e={}){let t=N(0),n=e.isObstacle??!1,i=e.cost??0,r=e.edges??[],s=I((()=>{let e={left:1,top:2,right:4,bottom:8};return r.map((t=>e[t]||0)).reduce(((e,t)=>e|t),0)}),"getEdgeMask"),o=s();return{id:"tile",tilePosOffset:e.offset??N(0),set tilePos(e){let n=this.getLevel();t=e.clone(),this.pos=N(this.tilePos.x*n.tileWidth(),this.tilePos.y*n.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(e){n!==e&&(n=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(e){i!==e&&(i=e,this.getLevel().invalidateNavigationMap())},get cost(){return i},set edges(e){r=e,o=s(),this.getLevel().invalidateNavigationMap()},get edges(){return r},get edgeMask(){return o},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(N(-1,0))},moveRight(){this.tilePos=this.tilePos.add(N(1,0))},moveUp(){this.tilePos=this.tilePos.add(N(0,-1))},moveDown(){this.tilePos=this.tilePos.add(N(0,1))}}}function Ui(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let n=qi([zn(t.pos??N(0))]),i=e.length,r=0,s=null,o=null,a=null,l=null,h=I((e=>e.x+e.y*r),"tile2Hash"),u=I((e=>N(Math.floor(e%r),Math.floor(e/r))),"hash2Tile"),d=I((()=>{s=[];for(let e of n.children)c(e)}),"createSpatialMap"),c=I((e=>{let t=h(e.tilePos);s[t]?s[t].push(e):s[t]=[e]}),"insertIntoSpatialMap"),p=I((e=>{let t=h(e.tilePos);if(s[t]){let n=s[t].indexOf(e);n>=0&&s[t].splice(n,1)}}),"removeFromSpatialMap"),f=I((()=>{let e=!1;for(let t of n.children){let i=n.pos2Tile(t.pos);(t.tilePos.x!=i.x||t.tilePos.y!=i.y)&&(e=!0,p(t),t.tilePos.x=i.x,t.tilePos.y=i.y,c(t))}e&&n.trigger("spatial_map_changed")}),"updateSpatialMap"),m=I((()=>{let e=n.getSpatialMap(),t=n.numRows()*n.numColumns();o?o.length=t:o=new Array(t),o.fill(1,0,t);for(let n=0;n<e.length;n++){let t=e[n];if(t){let e=0;for(let n of t){if(n.isObstacle){e=1/0;break}e+=n.cost}o[n]=e||1}}}),"createCostMap"),g=I((()=>{let e=n.getSpatialMap(),t=n.numRows()*n.numColumns();a?a.length=t:a=new Array(t),a.fill(15,0,t);for(let n=0;n<e.length;n++){let t=e[n];if(t){let e=t.length,i=15;for(let n=0;n<e;n++)i|=t[n].edgeMask;a[n]=i}}}),"createEdgeMap"),w=I((()=>{let e=n.numRows()*n.numColumns(),t=I(((e,t)=>{let n=[];for(n.push(e);n.length>0;){let e=n.pop();v(e).forEach((e=>{l[e]<0&&(l[e]=t,n.push(e))}))}}),"traverse");l?l.length=e:l=new Array(e),l.fill(-1,0,e);let i=0;for(let n=0;n<o.length;n++)l[n]>=0||t(n,i),i++}),"createConnectivityMap"),A=I(((e,t)=>o[t]),"getCost"),y=I(((e,t)=>{let n=u(e),i=u(t);return n.dist(i)}),"getHeuristic"),v=I(((e,t)=>{let n=[],s=Math.floor(e%r),l=s>0&&1&a[e]&&o[e-1]!==1/0,h=e>=r&&2&a[e]&&o[e-r]!==1/0,u=s<r-1&&4&a[e]&&o[e+1]!==1/0,d=e<r*i-r-1&&8&a[e]&&o[e+r]!==1/0;return t?(l&&(h&&n.push(e-r-1),n.push(e-1),d&&n.push(e+r-1)),h&&n.push(e-r),u&&(h&&n.push(e-r+1),n.push(e+1),d&&n.push(e+r+1)),d&&n.push(e+r)):(l&&n.push(e-1),h&&n.push(e-r),u&&n.push(e+1),d&&n.push(e+r)),n}),"getNeighbours"),V={id:"level",tileWidth:()=>t.tileWidth,tileHeight:()=>t.tileHeight,spawn(e,...i){let r=N(...i),o=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(t.tiles[e]){if("function"!=typeof t.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return t.tiles[e](r)}if(t.wildcardTile)return t.wildcardTile(e,r)})();if(!o)return null;let a=!1,l=!1;for(let t of o)"tile"===t.id&&(l=!0),"pos"===t.id&&(a=!0);a||o.push(zn()),l||o.push(Di());let h=n.add(o);return a&&(h.tilePosOffset=h.pos.clone()),h.tilePos=r,s&&(c(h),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),h},numColumns:()=>r,numRows:()=>i,levelWidth(){return r*this.tileWidth()},levelHeight(){return i*this.tileHeight()},tile2Pos(...e){return N(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=N(...e);return N(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(s||d(),s),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt(e){s||d();let t=h(e);return s[t]||[]},update(){s&&f()},invalidateNavigationMap(){o=null,a=null,l=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,t,n={}){var s;if(o||m(),a||g(),l||w(),e.x<0||e.x>=r||e.y<0||e.y>=i||t.x<0||t.x>=r||t.y<0||t.y>=i)return null;let d=h(e),c=h(t);if(o[c]===1/0)return null;if(d===c)return[];if(-1!=l[d]&&l[d]!==l[c])return null;let p=new Be(((e,t)=>e.cost<t.cost));p.insert({cost:0,node:d});let f=new Map;f.set(d,d);let V=new Map;for(V.set(d,0);0!==p.length;){let e=null==(s=p.remove())?void 0:s.node;if(e===c)break;let t=v(e,n.allowDiagonals);for(let n of t){let t=(V.get(e)||0)+A(e,n)+y(n,c);(!V.has(n)||t<V.get(n))&&(V.set(n,t),p.insert({cost:t,node:n}),f.set(n,e))}}let x=[],E=c,b=u(E);for(x.push(b);E!==d;){E=f.get(E);let e=u(E);x.push(e)}return x.reverse()},getPath(e,t,n={}){let i=this.tileWidth(),r=this.tileHeight(),s=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),n);return s?[e,...s.slice(1,-1).map((e=>e.scale(i,r).add(i/2,r/2))),t]:null}};return n.use(V),n.onNavigationMapInvalid((()=>{n.invalidateNavigationMap(),n.trigger("navigation_map_changed")})),e.forEach(((e,t)=>{let i=e.split("");r=Math.max(i.length,r),i.forEach(((e,i)=>{n.spawn(e,N(i,t))}))})),n}function Li(e={}){let t=null,n=null,i=null,r=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>n&&i?n[i]:null,getPath:()=>n?n.slice():null,getTarget:()=>t,isNavigationFinished:()=>!n||null===i,isTargetReachable:()=>null!==n,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),i=n?0:null,n?(r||(r=this.getLevel().onNavigationMapChanged((()=>{n&&null!==i&&(n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),i=n?0:null,n?this.trigger("navigation-next",this,n[i]):this.trigger("navigation-ended",this))})),this.onDestroy((()=>r.cancel()))),this.trigger("navigation-started",this),this.trigger("navigation-next",this,n[i])):this.trigger("navigation-ended",this)},update(){if(n&&null!==i){if(this.pos.sdist(n[i])<2){if(i===n.length-1)return this.pos=t.clone(),i=null,this.trigger("navigation-ended",this),void this.trigger("target-reached",this);i++,this.trigger("navigation-next",this,n[i])}this.moveTo(n[i],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(n)})}}function Ni(e){let t=h.canvas.captureStream(e),n=A.ctx.createMediaStreamDestination();A.masterNode.connect(n);let i=new MediaRecorder(t),r=[];return i.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},i.onerror=()=>{A.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop()))},i.start(),{resume(){i.resume()},pause(){i.pause()},stop:()=>(i.stop(),A.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop())),new Promise((e=>{i.onstop=()=>{e(new Blob(r,{type:"video/mp4"}))}}))),download(e="kaboom.mp4"){this.stop().then((t=>Re(e,t)))}}}function Oi(){return document.activeElement===h.canvas}function Gi(e){e.destroy()}I(mi,"body"),I(gi,"doubleJump"),I(wi,"shader"),I(Ai,"fixed"),I(yi,"stay"),I(vi,"health"),I(Vi,"lifespan"),I(xi,"state"),I(Ei,"fadeIn"),I(bi,"mask"),I(Si,"drawon"),I(Ri,"onLoad"),I(Mi,"scene"),I(ki,"go"),I(Ii,"onSceneLeave"),I(Ti,"getData"),I(Pi,"setData"),I(Bi,"plug"),I(Ci,"center"),(Fi=fi||(fi={}))[Fi.None=0]="None",Fi[Fi.Left=1]="Left",Fi[Fi.Top=2]="Top",Fi[Fi.LeftTop=3]="LeftTop",Fi[Fi.Right=4]="Right",Fi[Fi.Horizontal=5]="Horizontal",Fi[Fi.RightTop=6]="RightTop",Fi[Fi.HorizontalTop=7]="HorizontalTop",Fi[Fi.Bottom=8]="Bottom",Fi[Fi.LeftBottom=9]="LeftBottom",Fi[Fi.Vertical=10]="Vertical",Fi[Fi.LeftVertical=11]="LeftVertical",Fi[Fi.RightBottom=12]="RightBottom",Fi[Fi.HorizontalBottom=13]="HorizontalBottom",Fi[Fi.RightVertical=14]="RightVertical",Fi[Fi.All=15]="All",I(Di,"tile"),I(Ui,"addLevel"),I(Li,"agent"),I(Ni,"record"),I(Oi,"isFocused"),I(Gi,"destroy");let qi=V.root.add.bind(V.root),Hi=V.root.readd.bind(V.root),ji=V.root.removeAll.bind(V.root),Ki=V.root.get.bind(V.root),Yi=V.root.wait.bind(V.root),zi=V.root.loop.bind(V.root),Ji=V.root.tween.bind(V.root);function Qi(e=2,t=1){let n=0;return{require:["scale"],update(){let i=Math.sin(n*e)*t;i<0&&this.destroy(),this.scale=N(i),n+=vn()}}}I(Qi,"boom");let Wi=pe(null,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABdRJREFUeJzt3d3N3TYMgGG16ADdoAhyl7UyV9bqXRB0g2zQXgRGDcOWSIoUaX3vAwQBknMk/4gWLcnHrQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDEb9kb8FH99eeXf6Wf/efn35ynDyj1pEsb6G6NUxOYZ7sdB/QtPdnWRnn29gbKMYDUspPs0SgPb22cHANo/JG9AZF6wWBp3JLgeir36bvff3x9LOvzp2/dbSFA97bk5I4a9VMD7TXOUcP0uJ+d6emu5d6V1QvMs5nj8FZPx37X/b2TFpzShtnafeP0DipJMFnLnN3/w1OQ7tZgP+pA4VVKcHo0TG36KNULKGt5XsHZmi1APS5WM2Vqg0i7vbsG6YcIznN9vRTxXHavgdxtv6Tc3vc1pAHqdaG6ipwKYprpf1sFp6aH0gRTrxxLubPB2avHu+c/l3mICvqnsr//+Cq+qGrK1Xw/wzbBaRkNvSv3yew9cq+cu89L6nu6F/cMzCgzF1ftANlbe+Otp1IkDVxyVfbo6Z481f3507dhvXfbrk3HpdtjKTNqKuio8678c7mzF6ns6arfMyrVNoA75wMfNU2hKSeCx3Fq7dc+SPfDc39H9Vqn2CT//4bsYeT1PecOJyGSJdh6PZOlbElPZz2PHtlD1cUeS4LT4z5IOihwfNaD5ERm9qxH/dZ7Vmt9M999CtCZbdLUP/p3r2zFQ0paG8lr4Eb6+ZWBcSeq/qhyK6bXUfXOSgtO7/tOb9eT1NveqKttpYbiyXu/euV51JV16/T6e86zyF5TUp731V5Sp+Z7M71h9QvFNWWuvr0Sy4LzLfNvrel6zRX1e+hN2VzrnNlfaYD0xhCs++851lDh3vNV95xe6YvHgb8bwbNcuc+f09wbaUj2dzYgjz93//5kh94t0quCM8OKK6glKKuM0EYHfhUZWd8WwenZa0rLsp6s2YY66o0k9WUvS4NManBaGuo1eDIHgUZ1ePdkntsfFaCz5VZJdStsxyt7ziMNXHEAK5yk1mqmhrMPf1fcp57Vqe3SqZTMEduZhqAZyaywFne0DVHngHTZ11bznE88l/1lBZ9meP8851plWkBCO7drmQvWnL/sY/fKtFaqN3iy6iofsQxNktJnTMgfPXJUz3w3VaP5vOQ7Iyszvy2DczSi+aYFET2jINUEqFcAS4+rV480WlwRWXe07dLa0YGvfl9kmbTvPZJ1TXGvn4t4yuRp+2aMgk27wkm63DIztU3vOVfueC8wK4zKWtK0M+nvJXmOdlt65MgFFCva06qsKz044SvjIiN5TjLaaHxhtNyyouXBGZ1WSn66Ivt+M7pRZAWoZsDq+t2emeM1am/WtHxFG9runrO1/n1CxLK7CilxJM/H4bwuTJJBvWtgvm0gcNu01uvpd8la1soLE7xkpYDea4Ot6W3GOSzRc3o/qHw2M9qmXWA+uw+jbd0hyO9Yz0+vJ9QGcO/8ZV2YUqYVPN8dImXp3aJ/w1XTGGYfKZN+P7IXiXqO1uINLzFOm/Pz+BV4C03PNEqpZl//ELXP1ro8nhLyKLPHMyAiXyvh4cMFZ2uyAJXc62gzgJl1nhrSLMEzcLx+5qQnIhgqv6qhTHC2Zmus1tUuowCVDkRU6j0jgiJqhLPSSq2q7wMtMSBkdbcQWjNCq2nMlRrTnajAPP/t+c5Sj3K8VNueQ+pGzaa2MyOb2sZseW2dpL6ZnjMzfeQFt/Fe3XP2WIfGvRY6a569jCJ9TaIlcCS9KQE5p1TP2VrMbwLNDlZEvpE5AkGxh9f2nLO/QOetytIwAnMf6SfS2ns+jaZ6B4i2sWvSvF0HWOAj/aRGNFAaPXbw2rS2Rzr0T/ChshKNM3qd4135BCaqK9VAKy+lAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4DBC0k0jFtF9wAAAAASUVORK5CYII="),Xi=pe(null,"data:image/png;base64,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");function Zi(e,t={}){let n=qi([zn(e),yi()]),i=5*(t.speed||1),r=t.scale||1;n.add([oi(Xi),Jn(0),_n("center"),Qi(i,r),...t.comps??[]]);let s=n.add([oi(Wi),Jn(0),_n("center"),pi(),...t.comps??[]]);return s.wait(.4/i,(()=>s.use(Qi(i,r)))),s.onDestroy((()=>n.destroy())),n}function _i(){V.root.update()}I(Zi,"addKaboom"),I(_i,"updateFrame");const $i=class e{constructor(e,t,n,i=!1){R(this,"source"),R(this,"target"),R(this,"displacement"),R(this,"resolved",!1),this.source=e,this.target=t,this.displacement=n,this.resolved=i}reverse(){return new e(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}};I($i,"Collision");let er=$i;function tr(){let t={},n=e.hashGridSize||64,i=new K,r=[];function s(e){if(r.push(i.clone()),e.pos&&i.translate(e.pos),e.scale&&i.scale(e.scale),e.angle&&i.rotate(e.angle),e.transform=i.clone(),e.c("area")&&!e.paused){let i=e,r=i.worldArea().bbox(),s=Math.floor(r.pos.x/n),o=Math.floor(r.pos.y/n),a=Math.ceil((r.pos.x+r.width)/n),l=Math.ceil((r.pos.y+r.height)/n),h=new Set;for(let e=s;e<=a;e++)for(let n=o;n<=l;n++)if(t[e])if(t[e][n]){let r=t[e][n];e:for(let e of r){if(e.paused||!e.exists()||h.has(e.id))continue;for(let n of i.collisionIgnore)if(e.is(n))continue e;for(let n of e.collisionIgnore)if(i.is(n))continue e;let t=me(i.worldArea(),e.worldArea());if(t){let n=new er(i,e,t);i.trigger("collideUpdate",e,n);let r=n.reverse();r.resolved=n.resolved,e.trigger("collideUpdate",i,r)}h.add(e.id)}r.push(i)}else t[e][n]=[i];else t[e]={},t[e][n]=[i]}e.children.forEach(s),i=r.pop()}I(s,"checkObj"),s(V.root)}function nr(){let e=V.cam,t=L.fromAngle(X(0,360)).scale(e.shake);e.shake=F(e.shake,0,5*vn()),e.transform=(new K).translate(Ci()).scale(e.scale).rotate(e.angle).translate((e.pos??Ci()).scale(-1).add(t)),V.root.draw(),pt()}function ir(){let e=E();V.events.numListeners("loading")>0?V.events.trigger("loading",e):sn((()=>{let t=pn()/2,n=N(pn()/2,fn()/2).sub(N(t/2,12));Jt({pos:N(0),width:pn(),height:fn(),color:G(0,0,0)}),Jt({pos:n,width:t,height:24,fill:!1,outline:{width:4}}),Jt({pos:n,width:t*e,height:24})}))}function rr(e,t){sn((()=>{let n=N(8);qt(),Nt(e);let i=un({text:t,font:Vt,size:16,pos:n,color:G(255,255,255),fixed:!0}),r=i.width+2*n.x,s=i.height+2*n.x;e.x+r>=pn()&&Nt(N(-r,0)),e.y+s>=fn()&&Nt(N(0,-s)),Jt({width:r,height:s,color:G(0,0,0),radius:4,opacity:.8,fixed:!0}),cn(i),Ht()}))}function sr(){if(yn.inspect){let e=null;for(let t of V.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(V.root.drawInspect(),e){let t=[],n=e.inspect();for(let e in n)n[e]?t.push(`${e}: ${n[e]}`):t.push(`${e}`);rr(gn(wn()),t.join("\n"))}rr(N(8),`FPS: ${yn.fps()}`)}yn.paused&&sn((()=>{qt(),Nt(pn(),0),Nt(-8,8);Jt({width:32,height:32,anchor:"topright",color:G(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Jt({width:4,height:19.2,anchor:"center",pos:N(-32/3*e,16),color:G(255,255,255),radius:2,fixed:!0});Ht()})),1!==yn.timeScale&&sn((()=>{qt(),Nt(pn(),fn()),Nt(-8,-8);let e=un({text:yn.timeScale.toFixed(1),font:Vt,size:16,color:G(255,255,255),pos:N(-8),anchor:"botright",fixed:!0});Jt({width:e.width+16+32,height:e.height+16,anchor:"botright",color:G(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let n=yn.timeScale<1;Xt({p1:N(-e.width-8*(n?2:3.5),-8),p2:N(-e.width-8*(n?2:3.5),-8-e.height),p3:N(-e.width-8*(n?3.5:2),-8-e.height/2),pos:N(8*-t*1+(n?-4:0),0),color:G(255,255,255),fixed:!0})}cn(e),Ht()})),yn.curRecording&&sn((()=>{qt(),Nt(0,fn()),Nt(24,-24),Zt({radius:12,color:G(255,0,0),opacity:Y(0,1,4*h.time()),fixed:!0}),Ht()})),yn.showLog&&V.logs.length>0&&sn((()=>{var t;qt(),Nt(0,fn()),Nt(8,-8);let n=[];for(let e of V.logs){let i="",r=e.msg instanceof Error?"error":"info";i+=`[time]${e.time.toFixed(2)}[/time]`,i+=" ",i+=`[${r}]${(null==(t=e.msg)?void 0:t.toString)?e.msg.toString():e.msg}[/${r}]`,n.push(i)}V.logs=V.logs.filter((t=>h.time()-t.time<(e.logTime||4)));let i=un({text:n.join("\n"),font:Vt,pos:N(8,-8),anchor:"botleft",size:16,width:.6*pn(),lineSpacing:4,fixed:!0,styles:{time:{color:G(127,127,127)},info:{color:G(255,255,255)},error:{color:G(255,0,127)}}});Jt({width:i.width+16,height:i.height+16,anchor:"botleft",color:G(0,0,0),radius:4,opacity:.8,fixed:!0}),cn(i),Ht()}))}function or(e){V.events.on("loading",e)}function ar(e){h.onResize(e)}function lr(e){V.events.on("error",e)}function hr(e){console.error(e),A.ctx.suspend(),h.run((()=>{ft(),sn((()=>{let t=pn(),n=fn(),i={size:36,width:t-64,letterSpacing:4,lineSpacing:4,font:Vt,fixed:!0};Jt({width:t,height:n,color:G(0,0,255),fixed:!0});let r=un({...i,text:"Error",pos:N(32),color:G(255,128,0),fixed:!0});cn(r),dn({...i,text:e.message,pos:N(32,32+r.height+16),fixed:!0}),Ht(),V.events.trigger("error",e)})),Dt()}))}function ur(e){u.push(e)}function dr(){V.events.onOnce("frameEnd",(()=>{h.quit(),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);let e=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)d.activeTexture(d.TEXTURE0+t),d.bindTexture(d.TEXTURE_2D,null),d.bindTexture(d.TEXTURE_CUBE_MAP,null);d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null),c.destroy(),u.forEach((e=>e()))}))}I(tr,"checkFrame"),I(nr,"drawFrame"),I(ir,"drawLoadScreen"),I(rr,"drawInspectText"),I(sr,"drawDebug"),I(or,"onLoading"),I(ar,"onResize"),I(lr,"onError"),I(hr,"handleErr"),I(ur,"onCleanup"),I(dr,"quit");let cr=!0;function pr(){let t=o,n=d.drawingBufferWidth/t,i=d.drawingBufferHeight/t;if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let t=n/i,r=e.width/e.height;if(t>r){let e=i*r,t=(n-e)/2;p.viewport={x:t,y:0,width:e,height:i}}else{let e=n/r,t=(i-e)/2;p.viewport={x:0,y:t,width:n,height:e}}}else{if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");p.viewport={x:0,y:0,width:n,height:i}}}function fr(){h.onHide((()=>{e.backgroundAudio||A.ctx.suspend()})),h.onShow((()=>{!e.backgroundAudio&&!yn.paused&&A.ctx.resume()})),h.onResize((()=>{if(h.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(n.width=n.offsetWidth*o,n.height=n.offsetHeight*o,pr(),t||(p.frameBuffer.free(),p.frameBuffer=new $e(c,d.drawingBufferWidth,d.drawingBufferHeight),p.width=d.drawingBufferWidth/o,p.height=d.drawingBufferHeight/o))})),!1!==e.debug&&(h.onKeyPress("f1",(()=>yn.inspect=!yn.inspect)),h.onKeyPress("f2",(()=>yn.clearLog())),h.onKeyPress("f8",(()=>yn.paused=!yn.paused)),h.onKeyPress("f7",(()=>{yn.timeScale=Xn(C(yn.timeScale-.2,0,2),1)})),h.onKeyPress("f9",(()=>{yn.timeScale=Xn(C(yn.timeScale+.2,0,2),1)})),h.onKeyPress("f10",(()=>yn.stepFrame()))),e.burp&&h.onKeyPress("b",(()=>Xe()))}h.run((()=>{try{y.loaded||1===E()&&!cr&&(y.loaded=!0,V.events.trigger("load")),!y.loaded&&!1!==e.loadingScreen||cr?(ft(),ir(),Dt()):(yn.paused||_i(),tr(),ft(),nr(),!1!==e.debug&&sr(),Dt()),cr&&(cr=!1),V.events.trigger("frameEnd")}catch(t){hr(t)}})),I(pr,"updateViewport"),I(fr,"initEvents"),pr(),fr();let mr={VERSION:"3000.1.17",loadRoot:b,loadProgress:E,loadSprite:pe,loadSpriteAtlas:te,loadSound:Ue,loadBitmapFont:z,loadFont:T,loadShader:Ce,loadShaderURL:De,loadAseprite:Ve,loadPedit:ve,loadBean:Le,loadJSON:S,load:x,getSprite:Ne,getSound:Oe,getFont:Ge,getBitmapFont:qe,getShader:He,getAsset:je,Asset:rt,SpriteData:m,SoundData:w,width:pn,height:fn,center:Ci,dt:vn,time:h.time,screenshot:h.screenshot,record:Ni,isFocused:Oi,setCursor:h.setCursor,getCursor:h.getCursor,setCursorLocked:h.setCursorLocked,isCursorLocked:h.isCursorLocked,setFullscreen:h.setFullscreen,isFullscreen:h.isFullscreen,isTouchscreen:h.isTouchscreen,onLoad:Ri,onLoading:or,onResize:ar,onGamepadConnect:h.onGamepadConnect,onGamepadDisconnect:h.onGamepadDisconnect,onError:lr,onCleanup:ur,camPos:Vn,camScale:xn,camRot:En,shake:bn,toScreen:Sn,toWorld:Rn,setGravity:Hn,getGravity:jn,setBackground:Kn,getBackground:Yn,getGamepads:h.getGamepads,add:qi,make:kn,destroy:Gi,destroyAll:ji,get:Ki,readd:Hi,pos:zn,scale:Jn,rotate:Qn,color:Wn,opacity:Zn,anchor:_n,area:ri,sprite:oi,text:ai,polygon:li,rect:hi,circle:di,uvquad:ui,outline:ci,body:mi,doubleJump:gi,shader:wi,timer:pi,fixed:Ai,stay:yi,health:vi,lifespan:Vi,z:$n,move:ti,offscreen:ni,follow:ei,state:xi,fadeIn:Ei,mask:bi,drawon:Si,tile:Di,agent:Li,on:In,onUpdate:Tn,onDraw:Pn,onAdd:Bn,onDestroy:Cn,onClick:Nn,onCollide:Fn,onCollideUpdate:Dn,onCollideEnd:Un,onHover:On,onHoverUpdate:Gn,onHoverEnd:qn,onKeyDown:h.onKeyDown,onKeyPress:h.onKeyPress,onKeyPressRepeat:h.onKeyPressRepeat,onKeyRelease:h.onKeyRelease,onMouseDown:h.onMouseDown,onMousePress:h.onMousePress,onMouseRelease:h.onMouseRelease,onMouseMove:h.onMouseMove,onCharInput:h.onCharInput,onTouchStart:h.onTouchStart,onTouchMove:h.onTouchMove,onTouchEnd:h.onTouchEnd,onScroll:h.onScroll,onHide:h.onHide,onShow:h.onShow,onGamepadButtonDown:h.onGamepadButtonDown,onGamepadButtonPress:h.onGamepadButtonPress,onGamepadButtonRelease:h.onGamepadButtonRelease,onGamepadStick:h.onGamepadStick,mousePos:wn,mouseDeltaPos:h.mouseDeltaPos,isKeyDown:h.isKeyDown,isKeyPressed:h.isKeyPressed,isKeyPressedRepeat:h.isKeyPressedRepeat,isKeyReleased:h.isKeyReleased,isMouseDown:h.isMouseDown,isMousePressed:h.isMousePressed,isMouseReleased:h.isMouseReleased,isMouseMoved:h.isMouseMoved,isGamepadButtonPressed:h.isGamepadButtonPressed,isGamepadButtonDown:h.isGamepadButtonDown,isGamepadButtonReleased:h.isGamepadButtonReleased,getGamepadStick:h.getGamepadStick,charInputted:h.charInputted,loop:zi,wait:Yi,play:We,volume:Qe,burp:Xe,audioCtx:A.ctx,Line:ue,Rect:de,Circle:ce,Polygon:fe,Vec2:L,Color:O,Mat4:K,Quad:H,RNG:J,rand:X,randi:Z,randSeed:W,vec2:N,rgb:G,hsl2rgb:q,quad:j,choose:$,chance:_,lerp:F,tween:Ji,easings:gt,map:D,mapc:U,wave:Y,deg2rad:P,rad2deg:B,clamp:C,testLineLine:ne,testRectRect:ee,testRectLine:ie,testRectPoint:re,testCirclePolygon:le,testLinePoint:se,testLineCircle:oe,drawSprite:Yt,drawText:dn,formatText:un,drawRect:Jt,drawLine:Qt,drawLines:Wt,drawTriangle:Xt,drawCircle:Zt,drawEllipse:_t,drawUVQuad:jt,drawPolygon:$t,drawFormattedText:cn,drawMasked:tn,drawSubtracted:nn,pushTransform:qt,popTransform:Ht,pushTranslate:Nt,pushScale:Ot,pushRotate:Gt,pushMatrix:Lt,usePostEffect:mt,makeCanvas:nt,debug:yn,scene:Mi,go:ki,onSceneLeave:Ii,addLevel:Ui,getData:Ti,setData:Pi,download:Ee,downloadJSON:Se,downloadText:be,downloadBlob:Re,plug:Bi,ASCII_CHARS:yt,canvas:h.canvas,addKaboom:Zi,LEFT:L.LEFT,RIGHT:L.RIGHT,UP:L.UP,DOWN:L.DOWN,RED:O.RED,GREEN:O.GREEN,BLUE:O.BLUE,YELLOW:O.YELLOW,MAGENTA:O.MAGENTA,CYAN:O.CYAN,WHITE:O.WHITE,BLACK:O.BLACK,quit:dr,Event:Ae,EventHandler:ye,EventController:we};if(e.plugins&&e.plugins.forEach(Bi),!1!==e.global)for(let R in mr)window[R]=mr[R];return!1!==e.focus&&h.canvas.focus(),mr}),"default")({global:!1,touchToMouse:!0,canvas:document.getElementById("game"),debug:!1});function Ut(e,t){const n=document.getElementById("textbox-container"),i=document.getElementById("dialogue"),r=document.getElementById("close"),s=Array.isArray(e)?e:[e];let o=0,a=null;function l(e){let t=0,n="";a&&clearInterval(a),a=setInterval((()=>{if(t<e.length)return n+=e[t],i.innerHTML=n,void t++;clearInterval(a),a=null}),1)}function h(e){"Enter"!==e.code&&"Space"!==e.code||r.click()}n.style.display="block",r.textContent=s.length>1?"Next":"Close",r.addEventListener("click",(function e(){o++,o<s.length?(i.innerHTML="",r.textContent=o===s.length-1?"Close":"Next",l(s[o])):(t(),n.style.display="none",i.innerHTML="",a&&clearInterval(a),r.removeEventListener("click",e),r.textContent="Close",window.removeEventListener("keydown",h))})),window.addEventListener("keydown",h),l(s[0])}function Lt(e){e.width()/e.height()<1?e.camScale(e.vec2(1)):e.camScale(e.vec2(1.5))}function Nt(e,t,n,i=null,r=null,s=!1,o=0){const a=e.layers,l=Dt.add([Dt.sprite(t),Dt.pos(0),Dt.scale(n)]),h=function(e,t){return Dt.make([Dt.sprite("spritesheet",{anim:"idle-down"}),Dt.area({shape:new Dt.Rect(Dt.vec2(0,3),10,10)}),Dt.body(),Dt.anchor("center"),Dt.pos(),Dt.scale(t),Dt.z(1),{speed:125,direction:"down",isInDialogue:!1},"player"])}(0,n);for(const u of a)if("boundaries"!==u.name)if("enterhouse"===u.name&&i){for(const e of u.objects){const t=e.width||24,n=e.height||24;l.add([Dt.area({shape:new Dt.Rect(Dt.vec2(0),t,n)}),Dt.pos(e.x,e.y),"enterhouse"])}h.onCollide("enterhouse",i)}else if("exithouse"===u.name&&r){for(const e of u.objects){const t=e.width||24,n=e.height||24;l.add([Dt.area({shape:new Dt.Rect(Dt.vec2(0),t,n)}),Dt.pos(e.x,e.y),"exithouse"])}h.onCollide("exithouse",r)}else if("dialogue_triggers"!==u.name){if("spawnpoints"===u.name){const e=s?"player_exit":"player";let t=!1;for(const i of u.objects)if(i.name===e){h.pos=Dt.vec2((l.pos.x+i.x)*n,(l.pos.y+i.y)*n),t=!0;break}if(!t){const e=u.objects.find((e=>"player"===e.name));e&&(h.pos=Dt.vec2((l.pos.x+e.x)*n,(l.pos.y+e.y)*n))}Dt.add(h)}}else{o>0&&!window.__dialogueCooldowns&&(window.__dialogueCooldowns={});for(const e of u.objects){if(!e.name||!M[e.name])continue;const t=Math.max(1,e.width||16),i=Math.max(1,e.height||16);l.add([Dt.area({shape:new Dt.Rect(Dt.vec2(0),t,i)}),Dt.pos(e.x,e.y),e.name]);const r=e.name,s=e.x,a=e.y,u=t,d=i,c="Janet"===r||"wenzheng"===r||"mom"===r||"dad"===r||"shelves"===r||"kiki"===r||"moca"===r||"game_console"===r;h.onCollide(r,(()=>{if(!h.isInDialogue){if(o>0){if(Dt.time()-(window.__dialogueCooldowns[r]||0)<o)return}if(c){const e=(l.pos.y+(a+.5*d))*n,t=(l.pos.x+(s+.5*u))*n,i=h.pos.y>=e;if("Janet"===r||"dad"===r){const e=h.pos.x>=t;if(!i&&!e)return}else if("mom"===r){const e=h.pos.x<=t;if(!i&&!e)return}else if(!i)return}h.vel=Dt.vec2(0,0),"down"===h.direction?h.play("idle-down"):"up"===h.direction?h.play("idle-up"):"right"===h.direction?h.play("idle-right"):h.play("idle-left"),h.isInDialogue=!0,Ut(M[r],(()=>{h.isInDialogue=!1,o>0&&(window.__dialogueCooldowns[r]=Dt.time())}))}}))}}else for(const e of u.objects)e.width<=0||e.height<=0||(l.add([Dt.area({shape:new Dt.Rect(Dt.vec2(0),e.width,e.height)}),Dt.body({isStatic:!0}),Dt.pos(e.x,e.y),e.name]),e.name&&h.onCollide(e.name,(()=>{h.vel=Dt.vec2(0,0),"down"===h.direction?h.play("idle-down"):"up"===h.direction?h.play("idle-up"):"right"===h.direction?h.play("idle-right"):h.play("idle-left"),h.isInDialogue=!0,Ut(M[e.name],(()=>h.isInDialogue=!1))})));return{map:l,player:h}}Dt.loadSprite("spritesheet","./spritesheet.png",{sliceX:39,sliceY:31,anims:{"idle-down":964,"walk-down":{from:964,to:965,loop:!0,speed:8},"idle-right":1003,"walk-right":{from:1003,to:1004,loop:!0,speed:8},"idle-up":1042,"walk-up":{from:1042,to:1043,loop:!0,speed:8},"idle-left":1081,"walk-left":{from:1081,to:1082,loop:!0,speed:8},"npc-slime":{from:858,to:859,loop:!0,speed:4},"npc-kiki":{from:780,to:781,loop:!0,speed:4},"npc-moca":{from:788,to:789,loop:!0,speed:4},"npc-bunny":{from:780,to:781,loop:!0,speed:4},"npc-ghost":{from:864,to:865,loop:!0,speed:4}}}),Dt.loadSprite("island_map","./ceyline_island.png"),Dt.loadSprite("room_map","./map.png"),Dt.loadSprite("ceyline_house_map","./ceyline_house.png"),Dt.loadSound("bgm","./background_music.mp3"),Dt.loadSound("grass_walk","./grass_walking.m4a"),Dt.loadSound("door_open","./door_open.m4a"),Dt.loadSound("floor_walk","./floor_walk.m4a"),Dt.setBackground(Dt.Color.fromHex("#311047"));function Ot(e,t={}){const n=t.onStep;let i=!1,r=0;function s(){i=!1,"down"!==e.direction?"up"!==e.direction?"right"!==e.direction?e.play("idle-left"):e.play("idle-right"):e.play("idle-up"):e.play("idle-down")}Dt.onUpdate((()=>{if(e.isInDialogue)e.vel=Dt.vec2(0,0);else if(Dt.camPos(e.worldPos().x,e.worldPos().y-100),n&&i){const e=Dt.time();(0===r||e-r>=.35)&&(n(),r=e)}})),Dt.onMouseDown((t=>{if("left"!==t||e.isInDialogue)return;i=!0;const n=Dt.toWorld(Dt.mousePos());e.moveTo(n,e.speed);const r=e.pos.angle(n);return r>50&&r<125&&"walk-up"!==e.curAnim()?(e.play("walk-up"),void(e.direction="up")):r<-50&&r>-125&&"walk-down"!==e.curAnim()?(e.play("walk-down"),void(e.direction="down")):Math.abs(r)>125?(e.flipX=!1,"walk-right"!==e.curAnim()&&e.play("walk-right"),void(e.direction="right")):Math.abs(r)<50?(e.flipX=!1,"walk-left"!==e.curAnim()&&e.play("walk-left"),void(e.direction="left")):void 0})),Dt.onMouseRelease(s),Dt.onKeyRelease(s),Dt.onKeyDown((t=>{const n=[Dt.isKeyDown("right")||Dt.isKeyDown("d"),Dt.isKeyDown("left")||Dt.isKeyDown("a"),Dt.isKeyDown("up")||Dt.isKeyDown("w"),Dt.isKeyDown("down")||Dt.isKeyDown("s")];let r=0;for(const e of n)e&&r++;if(!(r>1||e.isInDialogue))return n[0]?(i=!0,e.flipX=!1,"walk-right"!==e.curAnim()&&e.play("walk-right"),e.direction="right",void e.move(e.speed,0)):n[1]?(i=!0,e.flipX=!1,"walk-left"!==e.curAnim()&&e.play("walk-left"),e.direction="left",void e.move(-e.speed,0)):n[2]?(i=!0,"walk-up"!==e.curAnim()&&e.play("walk-up"),e.direction="up",void e.move(0,-e.speed)):void(n[3]&&(i=!0,"walk-down"!==e.curAnim()&&e.play("walk-down"),e.direction="down",e.move(0,e.speed)))}))}Dt.scene("island",(async(e={})=>{var t;const n=document.getElementById("loading-screen"),i=document.getElementById("tap-to-start");i&&(i.style.display="none");const r=!0===e.useExitSpawn,s=await(await fetch("./ceyline_island.json")).json(),{player:o}=Nt(s,"island_map",3,(()=>{Dt.play("door_open",{volume:1}),Dt.go("ceyline_house")}),null,r,2),a={into_slime:"npc-slime",welcome_bunny:"npc-bunny"},l=null==(t=s.layers)?void 0:t.find((e=>"dialogue_triggers"===e.name));if(l)for(const h of l.objects){const e=a[h.name];if(!e)continue;const t=3*(h.x+(h.width||0)/2),n=3*(h.y+(h.height||0)/2);Dt.add([Dt.sprite("spritesheet",{anim:e}),Dt.pos(t,n),Dt.anchor("center"),Dt.scale(3),Dt.z(0)])}if(Lt(Dt),Dt.onResize((()=>Lt(Dt))),Ot(o,{onStep:()=>{Dt.play("grass_walk",{volume:.7})}}),n&&(n.style.display="none"),!window.__bgmStarted&&i){i.style.display="flex";const e=()=>{window.__bgmStarted=!0,Dt.play("bgm",{loop:!0,volume:.48}),i.style.display="none";const t=document.getElementById("game"),n=()=>{t&&t.focus({preventScroll:!0})};n(),requestAnimationFrame((()=>{n(),requestAnimationFrame(n)})),setTimeout(n,50),setTimeout(n,200);let r=0;const s=Dt.onUpdate((()=>{t&&document.activeElement!==t?(n(),r++,r>180&&s.cancel()):s.cancel()}));document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",e)};document.addEventListener("mousedown",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("keydown",e,{once:!0})}else if(window.__bgmStarted&&i){i.style.display="none";const e=document.getElementById("game");e&&e.focus()}})),Dt.scene("room",(async()=>{var e;const t=await(await fetch("./map.json")).json(),{player:n}=Nt(t,"room_map",3,null,(()=>{Dt.play("door_open",{volume:1}),Dt.go("island",{useExitSpawn:!0})}),null,!1),i={kiki:"npc-kiki",moca:"npc-moca"},r=null==(e=t.layers)?void 0:e.find((e=>"dialogue_triggers"===e.name));if(r)for(const s of r.objects){const e=i[s.name];if(!e)continue;const t=3*(s.x+(s.width||0)/2),n=3*(s.y+(s.height||0)/2);Dt.add([Dt.sprite("spritesheet",{anim:e}),Dt.pos(t,n),Dt.anchor("center"),Dt.scale(3),Dt.z(0)])}Lt(Dt),Dt.onResize((()=>Lt(Dt))),Ot(n,{onStep:()=>Dt.play("floor_walk",{volume:.7})})})),Dt.scene("ceyline_house",(async()=>{var e;const t=document.getElementById("loading-screen"),n=document.getElementById("tap-to-start");n&&(n.style.display="none");const i=await(await fetch("./ceyline_house.json")).json(),{player:r}=Nt(i,"ceyline_house_map",3,null,(()=>{Dt.play("door_open",{volume:1}),Dt.go("island",{useExitSpawn:!0})}),null,!1),s={ghost:"npc-ghost"},o=null==(e=i.layers)?void 0:e.find((e=>"dialogue_triggers"===e.name));if(o)for(const a of o.objects){const e=s[a.name];if(!e)continue;const t=3*(a.x+(a.width||0)/2),n=3*(a.y+(a.height||0)/2);Dt.add([Dt.sprite("spritesheet",{anim:e}),Dt.pos(t,n),Dt.anchor("center"),Dt.scale(3),Dt.z(0)])}if(Lt(Dt),Dt.onResize((()=>Lt(Dt))),Ot(r,{onStep:()=>Dt.play("floor_walk",{volume:.7})}),t&&(t.style.display="none"),!window.__bgmStarted&&n){n.style.display="flex";const e=()=>{window.__bgmStarted=!0,Dt.play("bgm",{loop:!0,volume:.48}),n.style.display="none";const t=document.getElementById("game");t&&t.focus({preventScroll:!0}),document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",e)};document.addEventListener("mousedown",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("keydown",e,{once:!0})}else if(window.__bgmStarted&&n){n.style.display="none";const e=document.getElementById("game");e&&e.focus()}})),Dt.go("island");
